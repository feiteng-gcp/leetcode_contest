#define ALL(x) (x).begin(), (x).end()

class Solution {
public:
  string mostCommonWord(string p, vector<string>& banned) {
    unordered_set<string> b(ALL(banned));
    unordered_map<string, int> c;
    for (size_t i = 0; i < p.size(); )
      if (!isalpha(p[i]))
        i++;
      else {
        size_t j = i;
        p[i] |= 32;
        while (isalpha(p[++j]))
          p[j] |= 32;
        c[p.substr(i, j-i)]++;
        i = j;
      }
    string opt;
    int optc = 0;
    for (auto& i : c)
      if (!b.count(i.first) && i.second > optc)
        optc = i.second, opt = i.first;
    return opt;
  }
};


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>122_sshang.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>122_sshang.py</CENTER></H3><HR>
<PRE>
<A NAME="0"></A><FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7-0.html#0',2,'match7-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>class Solution:
    def isSolvable(self, words: List[str], result: str) -&gt; bool:
        no_zero = set([result[0]])
        w_max = 0
        for w in words:
            no_zero.add(w[0])
            w_max = max(w_max, len(w))
            
        if w_max &gt; len(result):
            return False
        
        def find(i, cur_map, carry):
            cs = set()
            for w in words:
                if len(w) &gt;= i:
                    cs.add(w[-i])
            
            rev = {}
            for j, c in cur_map.items():
                rev[c] = j
            
            cands = [cur_map]
            for c in cs:
                if c not in rev:
                    n_cands = []

                    for cand in cands:
                        for j in range(10):
                            if j == 0 and c in no_zero:
                                continue
                            if j not in cand:
                                n_cand = copy.deepcopy(cand)
                                n_cand[j] = c
                                n_cands.append(n_cand)
                    cands = n_cands
                    
            for cand in cands:
                rev_map = {}
                for j, c in cand.items():
                    rev_map[c] = j
                    
                res = 0
                for w in words:
                    if len(w) &gt;= i:
                        res += rev_map[w[-i]]
                n_carry, cur = divmod(res + carry, 10)
                
                if len(result) &gt; i:
                    if result[-i] in rev_map and rev_map[result[-i]] == cur and find(i+1, cand, n_carry):
                        return True
                    elif result[-i] not in rev_map and cur not in cand:
                        cand[cur] = result[-i]
                        if find(i+1, cand, n_carry):
                            return True
                
                elif len(result) == i:
                    if result[-i] in rev_map and rev_map[result[-i]] == cur and n_carry == 0:
                        return True
                    elif result[-i] not in rev_map and cur not in cand:
                        return True
            return False
        
        return find(1</B></FONT>, {}, 0)
</PRE>

</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>153_Fancier.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>153_Fancier.java</CENTER></H3><HR>
<PRE>
class Solution {
    private String[] words;
<A NAME="0"></A>
    private String result;

    <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10-0.html#0',2,'match10-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>public boolean isSolvable(String[] words, String result) {
        this.words = words;
        this.result = result;
        int maxWordLength = Arrays.stream</B></FONT>(words).mapToInt(String::length).max().orElse(0);
        if (result.length() &lt; maxWordLength) {
            return false;
        }
        Mapping mapping = new Mapping();
<A NAME="1"></A>        return solvable(mapping, 0, 0);
    }

    <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10-0.html#1',2,'match10-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>private boolean solvable(Mapping mapping, int place, int increase) {
        if (place &gt;= result.length()) {
            return increase == 0;
        }

        List&lt;Character&gt; inputChars = new ArrayList&lt;&gt;();
<A NAME="2"></A>        for (String word : words) {
            if (word.length</B></FONT>() &gt; place) {
                inputChars.add(word.charAt(word.length() - 1 - place));
            <FONT color="#77bfc7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10-0.html#2',2,'match10-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
        }
        return solvable2(mapping, place, increase, inputChars, 0);
    }

    private boolean solvable2(Mapping mapping, int place, int increase, List&lt;Character&gt; inputChars, int charI) {
        while (charI &lt; inputChars.size()) {
            char c = inputChars.get(charI);
            if (!mapping.hasValue(c)) {
                for (int digit = 0; digit &lt; 10; digit++) {
                    if (!mapping.canSet</B></FONT>(digit)) {
                        continue;
                    }
                    Mapping next = new Mapping(mapping);
<A NAME="3"></A>                    next.set(c, digit);
                    if (solvable2(next, place, increase, inputChars, charI + 1)) {
                        return true;
                    <FONT color="#6cc417"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10-0.html#3',2,'match10-top.html#3',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
                }
                return false;
            }
            charI++;
        }

        int sum = inputChars.stream().mapToInt(mapping::get).sum() + increase;
        int resultValue = sum % 10</B></FONT>;
        char resultChar = result.charAt(result.length() - 1 - place);
        if (mapping.hasValue(resultChar)) {
            if (mapping.get(resultChar) != resultValue) {
                return false;
            }
<A NAME="4"></A>        } else {
            if (!mapping.canSet(resultValue)) {
                return false;
            <FONT color="#151b8d"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10-0.html#4',2,'match10-top.html#4',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
            mapping.set(resultChar, resultValue);
        }
        return solvable(mapping, place + 1, sum / 10);
    }

    private static class Mapping {
        private int[] alphabet = new int[26];
        private Set&lt;Integer&gt; leftDigits = new HashSet&lt;&gt;();

        public Mapping() {
            Arrays.fill(alphabet, -1);
            leftDigits.addAll(IntStream.range(0, 10).boxed().collect(Collectors.toList()));
        }

        public Mapping(Mapping template) {
            System.arraycopy(template.alphabet, 0, alphabet, 0, 26);
            leftDigits.addAll(template.leftDigits);
        }

        public boolean hasValue(char c) {
            return alphabet[c - 'A'] &gt;= 0;
        }

        public int get(char c) {
            return alphabet[c - 'A'];
        }

        public boolean canSet(int v) {
            return leftDigits.contains(v);
        }

        public void set(char c, int v) {
            leftDigits.remove(v);
            alphabet[c - 'A'] = v;
        }
    }
}</B></FONT>
</PRE>

</BODY>
</HTML>

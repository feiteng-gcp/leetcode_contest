<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>171_wisdompeak.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>171_wisdompeak.cpp</CENTER></H3><HR>
<PRE>
<A NAME="0"></A><FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match1-1.html#0',3,'match1-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>class Solution {        
public:
    bool isSolvable(vector&lt;string&gt;&amp; words, string result) 
    {        
        unordered_map&lt;char,int&gt;Map1;
        unordered_map&lt;int,char&gt;Map2;
        reverse(result.begin(),result.end());
        for (int i=0; i&lt;words.size(); i++)
        {
            reverse(words[i].begin(),words[i].end());
            if (words[i].size()&gt;result.size())
                return false;
        }            
        
        return DFS(words,result,0,0,0,Map1,Map2);
    }
    
    bool DFS(vector&lt;string&gt;&amp; words, string result, int a, int b, int sum, unordered_map&lt;char,int&gt;&amp;Map1, unordered_map&lt;int,char&gt;&amp;Map2)        
    {
        //cout&lt;&lt;&quot;dfs: &quot;&lt;&lt;a&lt;&lt;&quot; &quot;&lt;&lt;b&lt;&lt;endl;
              
        
        if (a==result.size())
        {
            //cout&lt;&lt;&quot;debug2&quot;&lt;&lt;endl;
            if (sum!=0)
                return false;
            for (int i=0; i&lt;words.size(); i++)
            {
                if (Map1[words[i].back()]==0)
                    return false;
            }
            if (Map1[result.back()]==0)
                return false;
            return true;
        }        
        

        if (b==words.size())
        {
            //cout&lt;&lt;&quot;debug1&quot;&lt;&lt;endl;
            if (Map1.find(result[a])!=Map1.end())
            {
                if (Map1[result[a]]!=sum%10)
                    return false;
                else
                    return DFS(words,result,a+1,0,sum/10,Map1,Map2);
            }
            else if (Map2.find(sum%10)!=Map2.end())                
            {
                if (Map2[sum%10]!=result[a])
                    return false;
                else
                    return DFS(words,result,a+1,0,sum/10,Map1,Map2);
            }
            
            else
            {
                    Map1[result[a]] = sum%10;
                    Map2[sum%10] = result[a];                    
                    if  (DFS(words,result,a+1,0,sum/10,Map1,Map2))
                        return true;
                    Map1.erase(result[a]);
                    Map2.erase(sum%10);
                    return false;                
            }           
        }             
            
        
        if (a&gt;=words[b].size())
        {
            //cout&lt;&lt;&quot;debug3&quot;&lt;&lt;endl;
            return DFS(words,result,a,b+1,sum,Map1,Map2);        
        }
            
        
        char ch = words[b][a];
        if (Map1.find(ch)!=Map1.end())
        {
            //cout&lt;&lt;&quot;debug4&quot;&lt;&lt;endl;            
            return DFS(words,result,a,b+1,sum+Map1[ch],Map1,Map2);
        }
        else
        {
            //cout&lt;&lt;&quot;debug5&quot;&lt;&lt;endl;
            for (int i=0; i&lt;=9; i++)
            {
                if (Map2.find(i)!=Map2.end())
                    continue;
                Map1[ch] = i;
                Map2[i] = ch;
                //cout&lt;&lt;ch&lt;&lt;&quot;-&gt;&quot;&lt;&lt;i&lt;&lt;endl;
                if (DFS(words,result,a,b+1,sum+i,Map1,Map2))
                    return true;
                
                Map1.erase(ch);
                Map2.erase(i);
            }
            return false;
        }
        
        return true;
    }
};</B></FONT>
</PRE>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>78_PiscesDream.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>78_PiscesDream.py</CENTER></H3><HR>
<PRE>
class UnionFindSet:
    def __init__(self):
        self._parent = {} 
        self._count = {}
        
    def union(self, key1, key2):    
        p1, p2 = self.find_parent(key1), self.find_parent(key2)
        if p1 == p2:
            return
        self._count[p1] += self._count.pop(p2)
        self._parent[p2] = p1
        
    def find_parent(self, key):
        if self._parent[key] == key:
            return key
        else: 
            self._parent[key] = self.find_parent(self._parent[key])
            return self._parent[key]
        
    def register(self, key):    
        self._parent[key] = key
        self._count[key] = 1
     
    def count(self, key):
        if key in self._count:
            return self._count[key]
        else:
            return self.count(self.find_parent(key))

class Solution:
    def largestComponentSize(self, arr):
        &quot;&quot;&quot;
        :type A: List[int]
        :rtype: int
        &quot;&quot;&quot;
        
<A NAME="0"></A>        max_num = max(arr) 
        primes = [] 
        non_primes = [False] * (max_num+1)
        <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match0-1.html#0',3,'match0-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>for num in range(2, max_num+1):
            if not non_primes[num]:
                primes.append(num)
                ptr = num
                while ptr &lt;= max_num:
                    non_primes[ptr] = True 
                    ptr += </B></FONT>num
#    
#       print(primes)
#       print(len(primes))
        from math import sqrt

        def get_factors(num):
            is_prime = True
#           for p in range(2, int(math.sqrt(num))+1):
            for p in primes:
                if num % p == 0:
                    is_prime = False
                    yield p
                    
                    while num % p == 0:
                        num //= p
                if p * p &gt; num:          
                    break
            if num &gt; 1:
                yield num

        from collections import defaultdict
        cnt = defaultdict(list) 
        
        for num in arr:
            for factor in get_factors(num):
                cnt[factor].append(num)
#               print(num, factor)
                
        ufs = UnionFindSet()
        for num in arr:
            ufs.register(num)
            
        for factor in cnt: 
            head = cnt[factor][0]
            for another in cnt[factor][1:]:
                ufs.union(head, another)
#       print(cnt)
                
        max_count = 1
        for num in arr:
            max_count = max(max_count, ufs.count(num))
        return max_count     
    
</PRE>

</BODY>
</HTML>

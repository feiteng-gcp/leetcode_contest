<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>302_von9333.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>302_von9333.java</CENTER></H3><HR>
<PRE>
class Solution {
    public int maxEqualFreq(int[] nums) {
        Map&lt;Integer, Integer&gt; frequency = new HashMap&lt;&gt;();
<A NAME="0"></A>        Map&lt;Integer, Integer&gt; freqCount = new HashMap&lt;&gt;();
        
        int longest = 1;
        <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match33-1.html#0',3,'match33-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>for (int i=0; i&lt;nums.length; i++) {
            int f = frequency.getOrDefault(nums[i], 0);
            f++;
            frequency.put(nums[i], f);
            
            int count = freqCount.getOrDefault(f-1, 0);
            // Value is not first time inserted.
            if (count != 0) {</B></FONT>
                count--;
                if (count == 0) {
                    freqCount.remove(f-1);
                } else {
                    freqCount.put(f-1, count);
                }
            }
            
            int newCount = freqCount.getOrDefault(f, 0);
            newCount++;
<A NAME="1"></A>            freqCount.put(f, newCount);
            
            // System.out.println(&quot;Validating round: &quot; + i + &quot; freq: &quot; + freqCount);
            if (isValid(freqCount)) <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match33-1.html#1',3,'match33-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>{
                longest = Math.max(longest, i+1);
            }
        }
            
        return longest;
    }</B></FONT>
    
    private boolean isValid(Map&lt;Integer, Integer&gt; freqCount) {
        if (freqCount.size() == 1) {
            if(freqCount.get(1) != null) {
                return true;
            }
            
            for (Map.Entry&lt;Integer, Integer&gt; e : freqCount.entrySet()) {
                if (e.getValue() == 1) {
                    return true;
                }
            }
            
            return false;
        }
        
        if (freqCount.size() != 2) {
            return false;
        }
        // Check if current i is valid.
        int sf = 0;
        int sfc = 0;
        int lf = 0;
        int lfc = 0;
        int index = 0;
        for (Map.Entry&lt;Integer, Integer&gt; e : freqCount.entrySet()) {
            int key = e.getKey();
            int value = e.getValue();
            if (index == 0) {
                sf = key;
                sfc = value;
                index ++;
            } else {
                lf = key;
                lfc = value;
            }
        }
        
        if ((sf == 1 &amp;&amp; sfc == 1) || (lf == 1 &amp;&amp; lfc == 1)) {
            return true;
        }
        
        // System.out.println(&quot;sf &quot; + sf + &quot; sfc &quot; + sfc + &quot; lf &quot; + lf + &quot; lfc &quot; + lfc);
        int diff = sf - lf;
        if (diff != 1 &amp;&amp; diff != -1) {
            return false;
        }
        
        if (sf &gt; lf) {
            return sfc == 1;
        } 
        
        return lfc == 1;
    }
}
</PRE>

</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>166_liuyubobobo.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>166_liuyubobobo.cpp</CENTER></H3><HR>
<PRE>
class Solution {
public:
    int numDupDigitsAtMostN(int N) {

        vector&lt;int&gt; diff(10, 0);
        for(int i = 1; i &lt;= 9; i ++)
            diff[i] = get_diff(i);
        for(int i = 1; i &lt; 10; i ++) diff[i] += diff[i - 1];
//        for(int e: diff) cout &lt;&lt; e &lt;&lt; &quot; &quot;; cout &lt;&lt; endl;

        vector&lt;int&gt; power10(10, 1);
        for(int i = 1; i &lt; 10; i ++) power10[i] = power10[i - 1] * 10;
//        for(int e: power10) cout &lt;&lt; e &lt;&lt; &quot; &quot;; cout &lt;&lt; endl;

        vector&lt;int&gt; num;
        while(N) num.push_back(N % 10), N /= 10;
        reverse(num.begin(), num.end());
//        for(int e: num) cout &lt;&lt; e &lt;&lt; &quot; &quot;; cout &lt;&lt; endl;

        int res = power10[num.size() - 1] - 1 - diff[num.size() - 1];
//        cout &lt;&lt; res &lt;&lt; endl;

        unordered_set&lt;int&gt; digits;
        for(int i = 0; i &lt; num.size(); i ++){

            if(i == num.size() - 1){
                for(int d = 0; d &lt;= num[i]; d ++)
                    if(digits.count(d)) res ++;
                break;
            }
            else if(num[i]){
                int tres = (num[i] - (i == 0)) * power10[num.size() - 1 - i];
                if(tres){
                    tres -= howmanydiff(num.size() - i, digits, num[i], i != 0);
                    res += tres;
                }
            }

            if(!digits.count(num[i]))
                digits.insert(num[i]);
            else{
                res += 1 + get_num(num, i + 1);
                break;
            }
        }
        return res;
    }

private:
    int howmanydiff(int n, const unordered_set&lt;int&gt;&amp; digits, int first, bool canZero){

        int res = 0;
        for(int i = canZero ? 0 : 1; i &lt; first; i ++)
            if(!digits.count(i)) res ++;
        n --;

        int cur = 10 - (digits.size() + 1);
        while(n --)
            res *= cur--;
<A NAME="0"></A>        return res;
    }

<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match32-0.html#0',2,'match32-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>    int get_num(const vector&lt;int&gt;&amp; num, int s){
        int res = 0;
        for(int i = s; i &lt; num.size(); i ++)
            res = res * 10 + num[i];
        return res;
    }</B></FONT>
    int get_diff(int n){

        int res = 9;
        n --;

        int cur = 9;
        while(n --) res *= cur --;
        return res;
    }
};
</PRE>
</BODY>
</HTML>

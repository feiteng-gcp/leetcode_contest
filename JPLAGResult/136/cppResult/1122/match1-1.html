<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>20_FoolPerson.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>20_FoolPerson.cpp</CENTER></H3><HR>
<PRE>
const int MAXN = 100005;
class Solution {
<A NAME="2"></A>public:
    string longestDupSubstring(string S) {
        suffixArray.work(S, SA, r, height, h);
<FONT color="#77bfc7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1-0.html#2',2,'match1-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>        int index, maxLen = -1;
        int L = S.length();
        for (int i = 0; i &lt; L; ++i) {
            if (h[i] &gt; maxLen) {
                maxLen = h[i];
                index = i;
            }
        }</B></FONT>
        return S.substr(index, maxLen);
    }
    
    typedef int ch_t; // Type of characters in the string
    ch_t s[MAXN];
    int r[MAXN], SA[MAXN], height[MAXN], h[MAXN];

    struct SuffixArray {
        int cnt[MAXN + 128], tmp[MAXN], newR[MAXN]; // Ensure that the size of cnt is not only greater than the maximum possible character (used in the first round) but also at least MAXN (used in the following loop)
        void work(const string s, int SA[], int r[], int height[], int h[]) {
            // s: the input string
            // SA, r, height, h: output
            // SA[i] is the index of the i-th smallest suffix
            // r[i] is the ranking of suffix substring s[i .. N - 1]
            // height[i] is the length of longest common prefix of i-th and (i-1)-th smallest suffix
            // h[i] = height[r[i]]
            int limit = 128; // Values of characters in the string is in [0, limit)
<A NAME="0"></A>            int N = s.length();
            // Calculate SA and r
            memset(cnt, 0, sizeof(int) * limit);
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1-0.html#0',2,'match1-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>            for (int i = 0; i &lt; N; ++i) ++cnt[r[i] = s[i]];
            for (int i = 1; i &lt; limit; ++i) cnt[i] += cnt[i - 1];
            for (int i = N - 1; i &gt;= 0; --i) SA[--cnt[s[i]]] = i;</B></FONT>
            for (int k = 1; k &lt;= N; k &lt;&lt;= 1) {
                int j = 0;
<A NAME="1"></A>                for (int i = N - 1; i &gt;= N - k; --i) tmp[j++] = i;
                for (int i = 0; i &lt; N; ++i) if (SA[i] &gt;= k) tmp[j++] = SA[i] - k;
                memset(cnt, 0, sizeof(int) * limit);
<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1-0.html#1',2,'match1-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>                for (int i = 0; i &lt; N; ++i) ++cnt[r[i]];
                for (int i = 1; i &lt; limit; ++i) cnt[i] += cnt[i - 1];
                for (int i = N - 1; i &gt;= 0; --i) SA[--cnt[r[tmp[i]]]] = tmp[i];
                newR[SA[0]] = 0;
                for (int i = 1; i &lt; N; ++i)
                    newR[SA[i]] = (SA[i] + k &lt; N &amp;&amp; SA[i - 1] + k &lt; N</B></FONT>
                                &amp;&amp; r[SA[i]] == r[SA[i - 1]] &amp;&amp; r[SA[i] + k] == r[SA[i - 1] + k])
                                ? newR[SA[i - 1]] : newR[SA[i - 1]] + 1;
                for (int i = 0; i &lt; N; ++i) r[i] = newR[i];
                limit = r[SA[N - 1]] + 1;
                if (limit &gt;= N) break;
            }
            // Calculate h
            for (int i = 0; i &lt; N; ++i) {
                if (0 == r[i])
                    h[i] = 0;
                else
                    for (h[i] = ((0 == i || 0 == h[i - 1]) ? 0 : (h[i - 1] - 1));
                         s[i + h[i]] == s[SA[r[i] - 1] + h[i]]; ++h[i]);
            }
            // Calculate height
            for (int i = 0; i &lt; N; ++i) height[i] = h[SA[i]];
        }
    }suffixArray;

};
</PRE>
</BODY>
</HTML>

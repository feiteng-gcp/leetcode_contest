<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>93_ralf_tianyi.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>93_ralf_tianyi.cpp</CENTER></H3><HR>
<PRE>
typedef long long ll;
const int max_size = 1e5 + 5;

struct node {
    int idx;
    int fst;
    int snd;
};

int T;
string S;
int vals[2][max_size];//one is pre state, the other is cur state
node v[max_size];
int rk[max_size];
int sa[max_size];
int lcp[max_size];
ll sums[max_size][27];//{len, dist}
int fst_apr_idx[max_size][26];

class Solution {
private:
    

    struct cmp {
        bool operator()(const node&amp; n1, const node&amp; n2) {
            if (n1.fst == n2.fst)
                return n1.snd &lt; n2.snd;
            return n1.fst &lt; n2.fst;
        }
<A NAME="0"></A>    };

    void get_suf_arr(string&amp; str) {
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match18-1.html#0',3,'match18-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        int len = str.size();
        for (int i = 0; i &lt; len; i++)
            vals[1][i] = str[i] - 'a';
        for (int cur = 0, step = 1; step &lt; len; cur = 1 - cur, step *= 2) {</B></FONT>
            int last = 1 - cur;
            for (int i = 0; i &lt; len; i++) {
                v[i].idx = i;
                v[i].fst = vals[last][i];
                v[i].snd = i + step &lt; len ? vals[last][i + step] : -1;
            }
            sort(v, v + len, cmp());
            vals[cur][v[0].idx] = 0;
            for (int i = 1, cur_rank = 0; i &lt; len; i++) {
                if (v[i].fst != v[i - 1].fst || v[i].snd != v[i - 1].snd)
                    cur_rank++;
                vals[cur][v[i].idx] = cur_rank;
            }
        }
        for (int i = 0; i &lt; len; i++)
            sa[i] = v[i].idx;
    }

    void get_lcp(string&amp; str) {
        int len = str.size();
        for (int i = 0; i &lt; len; i++)
            rk[sa[i]] = i;
        memset(lcp, 0, sizeof(lcp));
        for (int i = 0, k = 0; i &lt; len; i++, k = k ? k - 1 : 0) {
            if (rk[i] == len - 1) {
                k = 0;
                continue;
            }
            int j = sa[rk[i] + 1];
            while (i + k &lt; len &amp;&amp; j + k &lt; len &amp;&amp; str[i + k] == str[j + k])
                k++;
            lcp[i] = k;
        }
    }

    void get_idx() {
        for (int i = 0; i &lt; 26; i++)
            fst_apr_idx[S.size()][i] = -1;
        for (int i = S.size() - 1; i &gt;= 0; i--) {
            copy(fst_apr_idx[i + 1], fst_apr_idx[i + 1] + 26, fst_apr_idx[i]);
            fst_apr_idx[i][S[i] - 'a'] = i;
        }
    }
    
public:
    string longestDupSubstring(string S) {
        get_idx();
        get_suf_arr(S);
        get_lcp(S);
<A NAME="1"></A>        int len = S.size();
        int idx;
        int max_len = 0;
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match18-1.html#1',3,'match18-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        string ans = &quot;&quot;;
        for (int i = 0; i &lt; len; i++) {
            if (lcp[i] &gt; max_len) {
                idx = i;
                max_len = lcp[i];
            }
        }
        return S.substr(idx, lcp[idx]);
    }</B></FONT>
};
</PRE>
</BODY>
</HTML>

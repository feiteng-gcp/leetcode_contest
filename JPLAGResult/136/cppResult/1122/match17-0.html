<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>28_xietiansh.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>28_xietiansh.cpp</CENTER></H3><HR>
<PRE>
const int MaxN = 400000 + 10;

int N;
char Str[MaxN];
int SA[MaxN], Rank[MaxN], Height[MaxN];
int Cur[MaxN][2];
int E[MaxN], Next[MaxN], Node[MaxN];

bool Cmp(const int &amp;A, const int &amp;B)
{
	return Str[A] &lt; Str[B];
}

<A NAME="0"></A>void SAContruction(char *Str)
{
	N = strlen(Str) + 1;
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match17-1.html#0',3,'match17-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>	for (int i = 0; i &lt; N; i ++)
		SA[i] = i;
	sort(SA, SA + N, Cmp);
	Rank[SA[0]] = 0;
	for (int i = 1; i &lt; N; i ++)
		Rank[SA[i]] = (Str[SA[i]] &gt; Str[SA[i - 1]]) ? i : Rank[SA[i - 1]];
	
	for (int L = 1; ; L &lt;&lt;= 1)</B></FONT>
	{
		for (int i = 0; i &lt; N; i ++)
		{
			Cur[i][0] = Rank[i];
			Cur[i][1] = (i + L &lt; N) ? Rank[i + L] : 0;
		}
		memset(Node, -1, sizeof(Node));
		for (int i = 0; i &lt; N; i ++)
		{
			E[i] = i;
			Next[i] = Node[Cur[i][1]];
			Node[Cur[i][1]] = i;
		}
		int n = 0;
		for (int i = N; i &gt;= 0; i --)
			for (int t = Node[i]; t != -1; t = Next[t])
				SA[n ++] = E[t];
		memset(Node, -1, sizeof(Node));
		for (int i = 0; i &lt; N; i ++)
		{
			E[i] = SA[i];
			Next[i] = Node[Cur[SA[i]][0]];
			Node[Cur[SA[i]][0]] = i;
		}
		n = 0;
		for (int i = 0; i &lt;= N; i ++)
			for (int t = Node[i]; t != -1; t = Next[t])
				SA[n ++] = E[t];
		Rank[SA[0]] = 0;
		int Indep = 1;
		for (int i = 1; i &lt; N; i ++)
			if (Cur[SA[i]][0] == Cur[SA[i - 1]][0] &amp;&amp; Cur[SA[i]][1] == Cur[SA[i - 1]][1])
			{
				Rank[SA[i]] = Rank[SA[i - 1]];
				Indep = 0;
			}
			else
				Rank[SA[i]] = i;
		if (Indep)
			break;
	}
	int H = 0;
	for (int i = 0; i &lt; N; i ++)
		if (Rank[i] &gt;= 1)
		{
			if (H &gt; 0)
				H --;
			int j = SA[Rank[i] - 1];
			while (i + H &lt; N &amp;&amp; j + H &lt; N &amp;&amp; Str[i + H] == Str[j + H])
				H ++;
			Height[Rank[i]] = H;
		}
		else
			H = Height[Rank[i]] = 0;
	N --;
}

<A NAME="1"></A>class Solution {
public:
    string longestDupSubstring(string S) {
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match17-1.html#1',3,'match17-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        int N = S.length(), ans = 0, anspos = 0;
        for (int i = 0; i &lt; N; i++) Str[i] = S[i];
        Str[N] = 0;
        SAContruction(Str);
        for (int i = 1; i &lt;= N; i++) {</B></FONT>
            if (Height[i] &gt; ans) {
                ans = Height[i];
                anspos = SA[i];
            }
        }
        if (ans == 0) return &quot;&quot;;
        return S.substr(anspos, ans);
    }
};
</PRE>
</BODY>
</HTML>

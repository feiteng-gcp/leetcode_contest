<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>9_alpha_null.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>9_alpha_null.cpp</CENTER></H3><HR>
<PRE>
#include &lt;bits/stdc++.h&gt;
using namespace std;

typedef long long LL;
typedef pair&lt;LL,LL&gt; pii;

class Solution {
public:
    LL P1 = 1000000007, P2 = 1000000009;
    LL E1 = 23, E2 = 29;
    LL exp(LL v, LL p, LL M) {
        if (p == 0) return 1;
        if (p == 1) return v;
        if (p % 2 == 1) return (v * exp(v, p-1, M)) % M;
        return exp((v * v) % M, p / 2, M);
    }
    
    bool can(int x, int N, string &amp;S, string &amp;sol) {
        map&lt;pii,int&gt; M;
        LL v1 = 0, v2 = 0;
        for (int i=0;i&lt;x;++i) {
            v1 = (v1 * E1 + S[i]) % P1;
            v2 = (v2 * E2 + S[i]) % P2;
        }
        M[pii(v1, v2)] = 0;
        int ans = -1;
        for (int i=x;i&lt;N;++i) {
            v1 = (v1 * E1 - (exp(E1, x, P1) * S[i-x]) % P1 + P1 + S[i]) % P1;
            v2 = (v2 * E2 - (exp(E2, x, P2) * S[i-x]) % P2 + P2 + S[i]) % P2;
            if (M.find(pii(v1, v2)) != M.end()) {
                ans = M[pii(v1, v2)];
                break;
            }
            M[pii(v1, v2)] = i-x+1;
        }
        if (ans == -1) return false;
        sol = S.substr(ans, x);
<A NAME="0"></A>        return true;
    }
    
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match33-1.html#0',3,'match33-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    string longestDupSubstring(string S) {
        int N = S.length();
        int lo = 0, hi = N-1;
        string sol;
        while (hi &gt; lo) {
            int mid = (hi + lo + 1) / 2;
            if (can(mid, N, S, sol)) lo = mid;
            else hi = mid-1;
        }
        can(lo, N, S, sol);
        return sol;
    }
};</B></FONT>
</PRE>
</BODY>
</HTML>

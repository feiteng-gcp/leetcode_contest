<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>32_ZhongnianTao.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>32_ZhongnianTao.cpp</CENTER></H3><HR>
<PRE>
#define maxn 200100
int sa[maxn],rnk[maxn],lcp[maxn];
int t1[maxn],t2[maxn],c[maxn];
char s[maxn];

void build(int n,int m)
<A NAME="0"></A>{
	int *x=t1,*y=t2;
	register int i,k,p;
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7-0.html#0',2,'match7-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>	for(i=0;i&lt;m;i++) c[i]=0;
	for(i=0;i&lt;n;i++) c[x[i]=s[i]]++;
	for(i=1;i&lt;m;i++) c[i]+=c[i-1];
	for(i=n-1;i&gt;=0;i--) sa[--c[x[i]]]=i;
<A NAME="1"></A>	for(k=1;k&lt;=n;k&lt;&lt;=1)</B></FONT>
	{
		p=0;
<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7-0.html#1',2,'match7-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>		for(i=n-k;i&lt;n;i++) y[p++]=i;
		for(i=0;i&lt;n;i++) if (sa[i]&gt;=k) y[p++]=sa[i]-k;
		for(i=0;i&lt;m;i++) c[i]=0;
		for(i=0;i&lt;n;i++) c[x[y[i]]]++;
		for(i=1;i&lt;m;i++) c[i]+=c[i-1];
		for(i=n-1;i&gt;=0;i--) sa[--c[x[y[i]]]]=y[i];</B></FONT>
		swap(x,y);
		p=1;x[sa[0]]=0;
		for(i=1;i&lt;n;i++)
			x[sa[i]]=(y[sa[i-1]]==y[sa[i]] &amp;&amp; y[sa[i-1]+k]==y[sa[i]+k])?p-1:p++;
		if (p&gt;=n) break;
		m=p;
	}
	for(i=0;i&lt;n;i++)
		rnk[sa[i]]=i;
	k=0;
	for(i=0;i&lt;n;i++)
	{
		if (k) k--;
        if (rnk[i]==0) continue;
		int j=sa[rnk[i]-1];
		while (s[i+k]==s[j+k]) k++;
		lcp[rnk[i]]=k;
	}
}

class Solution {
public:
    string longestDupSubstring(string S) {
        memset(sa,0,sizeof(sa));
        memset(rnk,0,sizeof(rnk));
        memset(lcp,0,sizeof(lcp));
        memset(t1,0,sizeof(t1));
        memset(t2,0,sizeof(t2));
        memset(c,0,sizeof(c));
        memset(s,0,sizeof(s));
        int n=S.length();
        for(int i=0;i&lt;n;i++) s[i]=S[i];
        s[n]='\0';
        
<A NAME="2"></A>        build(n+1,128);
        
        int mxh=0;
<FONT color="#77bfc7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7-0.html#2',2,'match7-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>        int mxid=1;
        for(int i=2;i&lt;=n;i++)
        {
            if (lcp[i]&gt;mxh)
            {
                mxh=lcp[i];
                mxid=i;
            }
        }</B></FONT>
        
        int start=sa[mxid];
        
        string ans=S.substr(start,mxh);;
        
        return ans;
    }
};
</PRE>
</BODY>
</HTML>

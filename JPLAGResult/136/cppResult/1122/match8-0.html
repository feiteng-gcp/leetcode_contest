<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>78_suiyuan1992.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>78_suiyuan1992.cpp</CENTER></H3><HR>
<PRE>
const int maxn = 1000005;

#define F(x) ((x)/3+((x)%3==1?0:tb))
#define G(x) ((x)&lt;tb?(x)*3+1:((x)-tb)*3+2)

int wa[maxn],wb[maxn],wv[maxn],wss[maxn],a[maxn],rankk[maxn],height[maxn],sa[maxn];
int c0(int *r,int a,int b)
{return r[a]==r[b]&amp;&amp;r[a+1]==r[b+1]&amp;&amp;r[a+2]==r[b+2];}
int c12(int k,int *r,int a,int b)
{if(k==2) return r[a]&lt;r[b]||r[a]==r[b]&amp;&amp;c12(1,r,a+1,b+1);
  else return r[a]&lt;r[b]||r[a]==r[b]&amp;&amp;wv[a+1]&lt;wv[b+1];}
<A NAME="0"></A>void sort(int *r,int *a,int *b,int n,int m)
{
  int i;
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match8-1.html#0',3,'match8-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>  for(i=0;i&lt;n;i++) wv[i]=r[a[i]];
  for(i=0;i&lt;m;i++) wss[i]=0;
  for(i=0;i&lt;n;i++) wss[wv[i]]++;
  for(i=1;i&lt;m;i++) wss[i]+=wss[i-1];
  for(i=n-1;i&gt;=0;i--) b[--wss[wv[i]]]=a[i];</B></FONT>
  return;
}
void dc3(int *r,int *sa,int n,int m)
{
  int i,j,*rn=r+n,*san=sa+n,ta=0,tb=(n+1)/3,tbc=0,p;
  r[n]=r[n+1]=0;
  for(i=0;i&lt;n;i++) if(i%3!=0) wa[tbc++]=i;
  sort(r+2,wa,wb,tbc,m);
  sort(r+1,wb,wa,tbc,m);
  sort(r,wa,wb,tbc,m);
  for(p=1,rn[F(wb[0])]=0,i=1;i&lt;tbc;i++)
    rn[F(wb[i])]=c0(r,wb[i-1],wb[i])?p-1:p++;
<A NAME="1"></A>  if(p&lt;tbc) dc3(rn,san,tbc,p);
  else for(i=0;i&lt;tbc;i++) san[rn[i]]=i;
  for(i=0;i&lt;tbc;i++) if(san[i]&lt;tb) wb[ta++]=san[i]*3;
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match8-1.html#1',3,'match8-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>  if(n%3==1) wb[ta++]=n-1;
  sort(r,wb,wa,ta,m);
  for(i=0;i&lt;tbc;i++) wv[wb[i]=G(san[i])]=i;
  for(i=0,j=0,p=0;i&lt;ta &amp;&amp; j&lt;tbc;p++)</B></FONT>
    sa[p]=c12(wb[j]%3,r,wa[i],wb[j])?wa[i++]:wb[j++];
  for(;i&lt;ta;p++) sa[p]=wa[i++];
  for(;j&lt;tbc;p++) sa[p]=wb[j++];
<A NAME="2"></A>  return;
}

<FONT color="#77bfc7"><A HREF="javascript:ZweiFrames('match8-1.html#2',3,'match8-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>void calheight(int *r,int *sa,int n)
{
  int i,j,k=0;
  for(i=1;i&lt;=n;i++)rankk[sa[i]]=i;
  for(i=0;i&lt;n;height[rankk[i++]]=k)
    for(k?k--:0,j=sa[rankk[i]-1];r[i+k]==r[j+k];k++);</B></FONT>
}
 char str[maxn];
class Solution {
public:
    string longestDupSubstring(string S) {
       

    for(int i=0;i&lt;S.size();i++)str[i]=S[i];
        str[S.size()]=0;
        int len,i,j,start,last;
    len = S.size();
    for (i=0;i&lt;len;i++)
    {
      a[i] = static_cast&lt;int&gt;(str[i]);
    }
    a[len] = 0;
    dc3(a,sa,len+1,250);
    calheight(a,sa,len);
    start = last = 0;
    for(i=1;i&lt;=len;i++)
    {
      if(last &lt; height[i])
      {
        last = height[i];
        start = sa[i];
      }
    }
    vector&lt;char&gt;ans;
    for(i=start,j=0;j&lt;last;j++,i++)ans.push_back(str[i]);
        string ret = string(ans.size(),'a');
        for(int i=0;i&lt;ans.size();i++)ret[i]=ans[i];
        return ret;
     }
};
</PRE>
</BODY>
</HTML>

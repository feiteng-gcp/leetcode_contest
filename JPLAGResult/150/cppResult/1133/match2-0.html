<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>221_jariasf.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>221_jariasf.cpp</CENTER></H3><HR>
<PRE>
class Solution {
public:
    #define MAXN 100005
    #define Clear(a) memset(a,0,sizeof(a))
    #define Max(a,b) a&gt;b?a:b
    #define Min(a,b) a&lt;b?a:b
    #define F(x) ((x)/3+((x)%3==1?0:tb))
    #define G(x) ((x)&lt;tb?(x)*3+1:((x)-tb)*3+2)
    int wa[ MAXN ] , wb[ MAXN ],wv[ MAXN ], wss[ MAXN ];
<A NAME="0"></A>    int LCP[ MAXN ], pos[ MAXN * 3 ], rank[ MAXN ], r[ MAXN * 3 ];
    char s[ MAXN ];

<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match2-1.html#0',3,'match2-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    int c0(int r[],int a,int b) {return r[a]==r[b]&amp;&amp;r[a+1]==r[b+1]&amp;&amp;r[a+2]==r[b+2];}
    int c12(int k,int r[],int a,int b) {
        if( k == 2 )
            return r[a]&lt;r[b]||r[a]==r[b]&amp;&amp;c12(1,r,a+1,b+1);
<A NAME="1"></A>        else return r[a]&lt;r[b]||r[a]==r[b]&amp;&amp;wv[a+1]&lt;wv[b+1];</B></FONT>
    }
    
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match2-1.html#1',3,'match2-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    void sort(int r[],int a[],int b[],int n,int m){
         int i;
         for( i = 0 ; i &lt; n ; ++i ) wv[ i ] = r[ a[ i ] ];
         for( i = 0 ; i &lt; m ; ++i ) wss[ i ] = 0;
<A NAME="2"></A>         for( i = 0 ; i &lt; n ; ++i ) wss[wv[i]]++;
         for( i = 1 ; i &lt; m ; ++i ) wss[ i ] += wss[i-1];
         for( i = n - 1 ; i &gt;= 0 ; --i ) b[--wss[wv[i]]]=a[i];</B></FONT>
<FONT color="#77bfc7"><A HREF="javascript:ZweiFrames('match2-1.html#2',3,'match2-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>         return;
    }

    void dc3(int r[],int pos[],int n,int m){
         int i , j , *rn = r + n ,*san=pos+n,ta=0,tb=(n+1)/3,tbc=0,p;
         r[ n ] = r[ n + 1 ] = 0;
         for( i = 0 ; i &lt; n ; ++i ) if( i % 3 != 0 ) wa[ tbc++ ]=i;
         sort( r + 2 , wa , wb , tbc , m );
         sort( r + 1 , wb , wa , tbc , m );
         sort( r , wa , wb , tbc , m );
         for( p = 1 , rn[ F( wb[ 0 ] ) ] = 0 ,i=1; i&lt;tbc; ++i)
         rn[ F( wb[ i ] ) ] = c0( r , wb[i-1] , wb[i] )?p-1:p++;
         if( p &lt; tbc ) dc3( rn , san , tbc , p );
         else for( i = 0 ; i &lt; tbc ; ++i ) san[rn[i]] = i;
         for( i = 0 ; i &lt; tbc; ++i )if(san[i]&lt;tb) wb[ta++]=san[i]*3;
         if( n % 3 == 1 ) wb[ta++] = n - 1;
         sort( r , wb , wa , ta , m );
         for( i = 0 ; i &lt; tbc ; ++i ) wv[wb[i]=G(san[i])]=i;
         for( i = 0 ,j=0 , p=0 ; i&lt;ta &amp;&amp; j &lt; tbc ; ++p )
         pos[ p ] =c12(wb[j]%3,r,wa[i],wb[j])?wa[i++]:wb[j++];
         for( ; i &lt; ta ; ++p ) pos[ p ] = wa[ i++ ];
         for( ; j &lt; tbc ; ++p ) pos[ p ] = wb[ j++ ];
<A NAME="3"></A>         return;
    }

    void getLCP( int r[], int pos[], int n, int rank[], int LCP[]){</B></FONT><FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match2-1.html#3',3,'match2-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>
         int i , j , k = 0 ;
         for( i = 1 ; i &lt;= n ;++i) rank[ pos[ i ] ] = i;
         for( i = 0 ; i &lt; n ; LCP[ rank[ i++ ] ] = k )
         for( k ? k--:0, j = pos[rank[i]-1]; r[i+k]==r[j+k] ; ++k );
         return;
    }</B></FONT>

    void get_suffix(string s, int rank[], int pos[], int LCP[]){
        int n = s.size();
        for( int i = 0 ; i &lt;= n ; ++i ) r[ i ] = s[ i ];
        dc3( r , pos, n + 1 , 256);
        getLCP( r, pos , n , rank , LCP );
    }
    
    string lastSubstring(string s) {
        int len = s.size();
        Clear( rank );Clear( pos ); Clear( LCP );
        get_suffix( s , rank, pos , LCP );
        //for( int i = 1 ; i &lt;= len ; ++i ){
        //    cout&lt;&lt;pos[i]&lt;&lt;&quot; &quot;&lt;&lt;LCP[i]&lt;&lt;&quot; &quot;&lt;&lt;s.substr(pos[i])&lt;&lt;endl;    
        //}
        return s.substr(pos[len]);
    }
};
</PRE>
</BODY>
</HTML>

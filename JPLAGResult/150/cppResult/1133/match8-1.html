<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>210_leepfy.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>210_leepfy.cpp</CENTER></H3><HR>
<PRE>
class SuffixTree {
public:
	int m=128;
	vector&lt;int&gt; sa;
	vector&lt;int&gt; rank;
	vector&lt;int&gt; x;
	vector&lt;int&gt; y;
	vector&lt;int&gt; c;
	vector&lt;int&gt; height;
	int len;
	string s;

	SuffixTree(string str)
		: s(str)
		,len(str.size())
		,sa(str.size(),0)
		,rank(str.size(),0)
		,c(200000,0)
		,x(str.size(),0)
		,y(str.size(),0)
		,height(str.size(),0)
	{
		buildSa();
		buildHeight();
	}
<A NAME="0"></A>
	void buildSa()
	{
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match8-0.html#0',2,'match8-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>		for(int i=0; i&lt;len; i++) c[x[i]=s[i]]++;
		for(int i=1; i&lt;m; i++) c[i]+=c[i-1];
		for(int i=len-1; i&gt;=0; i--) sa[--c[x[i]]]=i;
		for(int k=1; k&lt;=len; k&lt;&lt;=1) {
			int num=0;
			for(int i=len-k; i&lt;len; i++) y[num++]=i;
			for(int i=0; i&lt;len; i++) if(sa[i]&gt;=k) y[num++]=sa[i]-k;
<A NAME="1"></A>			fill(c.begin(),c.end(),0);
			for(int i=0; i&lt;len; i++) c[x[i]]++;
			for(int i=1; i&lt;m; i++) c[i]+=c[i-1];
			for(int i=len-1; i&gt;=0; i--) sa[--c[x[y[i]]]]=y[i];</B></FONT><FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match8-0.html#1',2,'match8-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>

			num=0;
			y=x;
			x[sa[0]]=0;
			for(int i=1; i&lt;len; i++)
				x[sa[i]]=(y[sa[i]]==y[sa[i-1]]&amp;&amp;sa[i]+k&lt;len &amp;&amp; sa[i-1]+k&lt;len &amp;&amp; y[sa[i]+k]==y[sa[i-1]+k])?num:++num;

			if(num==len-1) break;
			m=num+1;
		}</B></FONT>
		for(int i=0; i&lt;len; i++) rank[sa[i]]=i;
	}

	void buildHeight()
	{
		int k=0;
		for(int i=0; i&lt;len; i++) {
			if(rank[i]==0) continue;
			if(k)
				k--;
			int j=sa[rank[i]-1];
			while(j+k&lt;len &amp;&amp; i+k&lt;len &amp;&amp; s[i+k]==s[j+k])
				k++;
			height[rank[i]]=k;
		}
	}

};

class Solution {
public:
	string lastSubstring(string s) {
		SuffixTree ST(s);
		return s.substr(ST.sa.back());
	}
};
</PRE>
</BODY>
</HTML>

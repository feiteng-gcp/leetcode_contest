<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>158_love-algorithm.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>158_love-algorithm.java</CENTER></H3><HR>
<PRE>
class Solution {

  private Set&lt;Integer&gt; set;
  private char[][] grid;

  public int minPushBox(char[][] grid) {
    set = new HashSet&lt;&gt;();
    this.grid = grid;
    int n = grid.length;
<A NAME="0"></A>    int m = grid[0].length;
    Deque&lt;Integer&gt; queue = new ArrayDeque&lt;&gt;();
    int boxR = 0, boxC = 0, pr = 0, pc = 0, tarR = 0, tarC = 0;
    <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match11-1.html#0',3,'match11-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>for (int i = 0; i &lt; grid.length; i++) {
      for (int j = 0; j &lt; grid[i].length; j++) {
        if (grid[i][j] == 'T') {
<A NAME="1"></A>          tarR = i;
          t</B></FONT>arC = j;
        } else if (grid[i][j] == 'B') {
          <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match11-1.html#1',3,'match11-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>boxR = i;
          boxC = j;
        } else if (grid[i][j] == 'S') {
          pr = i;
          pc = j;
        }
      }
    }</B></FONT>
    addStatus(queue, boxR, boxC, pr, pc, new boolean[n][m]);
    int pushCnt = 0;
    while (!queue.isEmpty()) {
      int size = queue.size();
      while (size-- &gt; 0) {
        int status = queue.poll();
        boxR = status &gt;&gt; 24;
        boxC = (status &gt;&gt; 16) &amp; ((1 &lt;&lt; 8) - 1);
        pr = (status &gt;&gt; 8) &amp; ((1 &lt;&lt; 8) - 1);
        pc = status &amp; ((1 &lt;&lt; 8) - 1);
        if (boxR == tarR &amp;&amp; boxC == tarC) {
          return pushCnt;
        }
        if (boxR == pr + 1) {
          if (isValid(boxR + 1, boxC) &amp;&amp; (grid[boxR + 1][boxC] != '#')) {
            addStatus(queue, boxR + 1, boxC, pr, pc, new boolean[n][m]);
          }
        } else if (boxR == pr - 1) {
          if (isValid(boxR - 1, boxC) &amp;&amp; (grid[boxR - 1][boxC] != '#')) {
            addStatus(queue, boxR - 1, boxC, pr, pc, new boolean[n][m]);
          }
        } else if (boxC == pc + 1) {
          if (isValid(boxR, boxC + 1) &amp;&amp; (grid[boxR][boxC + 1] != '#')) {
            addStatus(queue, boxR, boxC + 1, pr, pc, new boolean[n][m]);
          }
        } else {
          if (isValid(boxR, boxC - 1) &amp;&amp; (grid[boxR][boxC - 1] != '#')) {
            addStatus(queue, boxR, boxC - 1, pr, pc, new boolean[n][m]);
          }
        }
      }
      pushCnt++;
    }
    return -1;
  }

  private boolean isValid(int r, int c) {
<A NAME="2"></A>    return r &gt;= 0 &amp;&amp; r &lt; grid.length &amp;&amp; c &gt;= 0 &amp;&amp; c &lt; grid[0].length;
  }

  <FONT color="#77bfc7"><A HREF="javascript:ZweiFrames('match11-1.html#2',3,'match11-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>private int[][] dirs = new int[][]{{1, 0}, {-1, 0}, {0, 1}, {0, -1}</B></FONT>};

  private void addStatus(Deque&lt;Integer&gt; queue, int boxR, int boxC, int r, int c,
      boolean[][] mark) {
    if (!isValid(r, c) || grid[r][c] == '#' || ((r == boxR) &amp;&amp; (c == boxC)) || mark[r][c]) {
      return;
    }
<A NAME="3"></A>    mark[r][c] = true;
    if ((boxR == r &amp;&amp; Math.abs(boxC - c) == 1) || (boxC == c &amp;&amp; Math.abs(boxR - r) == 1)) {
      int status = c + (r &lt;&lt; 8) + (boxC &lt;&lt; 16) + (boxR &lt;&lt; 24);
      <FONT color="#6cc417"><A HREF="javascript:ZweiFrames('match11-1.html#3',3,'match11-top.html#3',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>if (!set.contains(status)) {
        set.add(status);
        queue.offer(status);
      }
    }</B></FONT>
    for (int[] dir : dirs) {
      int nr = r + dir[0];
      int nc = c + dir[1];
      addStatus(queue, boxR, boxC, nr, nc, mark);
    }
  }
}
</PRE>

</BODY>
</HTML>

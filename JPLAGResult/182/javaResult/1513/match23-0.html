<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>80_HenryLee4.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>80_HenryLee4.java</CENTER></H3><HR>
<PRE>
class Solution {

  public int findGoodStrings(int n, String s1, String s2, String evil) {
    int mod = (int) 1e9 + 7;
    int m = evil.length();
    long[][][] dp = new long[n + 1][4][m + 1]; // 0表示1 2都有限制，1表1有限制， 2表示2有限制， 3表示无限制
    for (int i = 0; i &lt; m; i++) {
      dp[n][0][i] = 1;
      dp[n][1][i] = 1;
      dp[n][2][i] = 1;
      dp[n][3][i] = 1;
    }
    char[] p = evil.toCharArray();
    int[] prefix = calcuPrefixFunction(p);
    for (int i = n - 1; i &gt;= 0; i--) {
      for (int j = 0; j &lt; m; j++) {
        // handle 0
        for (char k = s1.charAt(i); k &lt;= s2.charAt(i); k++) {
          int state = 0;
          if (k == s1.charAt(i) &amp;&amp; k == s2.charAt(i)) {
            state = 0;
          } else if (k == s1.charAt(i)) {
            state = 1;
          } else if (k == s2.charAt(i)) {
            state = 2;
          } else {
            state = 3;
          }
          if (k == evil.charAt(j)) {
            if (j != m - 1) {
              dp[i][0][j] += dp[i + 1][state][j + 1];
              dp[i][0][j] %= mod;
            }
          } else {
            dp[i][0][j] += dp[i + 1][state][getNext(prefix, p, k, j)];
            dp[i][0][j] %= mod;
          }
        }
        // handle 1
        for (char k = s1.charAt(i); k &lt;= 'z'; k++) {
          int state = k == s1.charAt(i) ? 1 : 3;
          if (k == evil.charAt(j)) {
            if (j != m - 1) {
              dp[i][1][j] += dp[i + 1][state][j + 1];
              dp[i][1][j] %= mod;
            }
          } else {
            dp[i][1][j] += dp[i + 1][state][getNext(prefix, p, k, j)];
            dp[i][1][j] %= mod;
          }
        }
        //handle 2
        for (char k = 'a'; k &lt;= s2.charAt(i); k++) {
          int state = k == s2.charAt(i) ? 2 : 3;
          if (k == evil.charAt(j)) {
            if (j != m - 1) {
              dp[i][2][j] += dp[i + 1][state][j + 1];
              dp[i][2][j] %= mod;
            }
          } else {
            dp[i][2][j] += dp[i + 1][state][getNext(prefix, p, k, j)];
            dp[i][2][j] %= mod;
          }
        }
        // handle 3
        for (char k = 'a'; k &lt;= 'z'; k++) {
          int state = 3;
          if (k == evil.charAt(j)) {
            if (j != m - 1) {
              dp[i][3][j] += dp[i + 1][state][j + 1];
              dp[i][3][j] %= mod;
            }
          } else {
            dp[i][3][j] += dp[i + 1][state][getNext(prefix, p, k, j)];
            dp[i][3][j] %= mod;
          }
        }
      }
    }
    return (int) dp[0][0][0];
  }

  private int[] calcuPrefixFunction(char[] p) { // 考虑边界情况， 即p的长度为0
    int n = p.length;
    int[] prefixArray = new int[n];  // 表示匹配的长度结果
    prefixArray[0] = 0;
    int j = 0;  // len of match string 表示匹配的长度
    for (int i = 1; i &lt; n; i++) {
      while (j &gt; 0 &amp;&amp; p[i] != p[j]) {
        j = prefixArray[j - 1];
<A NAME="0"></A>      }
      if (p[i] == p[j]) {
        j++;
      <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match23-1.html#0',3,'match23-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>}
      prefixArray[i] = j;
    }
    return prefixArray;
  }

  private int getNext(int[] prefix, char[] p, char c, int j){</B></FONT>
    while(j &gt; 0 &amp;&amp; c != p[j]){
      j = prefix[j - 1];
    }
    if(c == p[j]){
      j++;
    }
    return j;
  }
}
</PRE>

</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>76_hupili.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>76_hupili.py</CENTER></H3><HR>
<PRE>
import copy

class Solution:
    def maxStudents(self, seats: List[List[str]]) -&gt; int:
        '''
        Sounds like a bipartite matching problem, or max flow.
        Since the data size is really small, let's try search first..
        memorised search --&gt; DP.
        
        Reducing # of possible states is still a challenge.
        
        Since the students can only peek into nearest row/ column,
        for each rectangle ending at (i, j),
        we can have row profle plus a column profile (2^8 + 2^8),
        if every profile's optimal for (i, j) is recorded,
        the internal allocation is irrelevant.
        
        Further more, since students only look ahead, we can arrange the solution in row order.
        Only maintan row profile: 2^8.
        Search next row: 2^8 (profiles) * 2^8 (compatibility check)
        In total 8 rows.
        Time: 8 * 2^8 * 2^8 = 2 ^ 19
        
        Sounds like a solution
        '''
        
        m, n = len(seats), len(seats[0])
        
        profile = [0] * (2**n)
        
        def profile2int(p):
            r = 0
            for a in p:
                r &lt;&lt;= 1
                r += a
            return r
        
        def int2profile(a):
            r = []
            for _ in range(n):
                r.append(a &amp; 1)
                a &gt;&gt;= 1
            # print(a)
            # print(r)
            return list(reversed(r))
        
        def valid(j, i):
            '''
            profile j in i-th row
<A NAME="0"></A>            '''
            jp = int2profile(j)
            for x in range(n):
                if seats[i]<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match6-1.html#0',3,'match6-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>[x] == '#' and jp[x] == 1:
                    return False
            for x in range(1, n):
                if jp[x] == 1 and jp[x - 1] == 1:
                    return False
            return True
            
        def compatible(j, k):
            '''
            j: new profile
            k: last profile
            '''
            jp = int2profile(j)
            kp = int2profile(k)
            for x in range(n):
                if jp[</B></FONT>x]:
                    if x - 1 &gt;= 0 and kp[x - 1] == 1:
                        return False
                    if x + 1 &lt; n and kp[x + 1] == 1:
                        return False
            return True
            
        
        for i in range(m):
            new = [0] * (2**n) # 0 is always possible for any profile
            jj = []
            for j in range(2**n):
                if valid(j, i):
                    c = sum(int2profile(j))
                    jj.append((j, c))
            # print(i, jj)
            for j, c in jj:
                for k in range(2**n):
                    if compatible(j, k):
                        # print('ok:', j, k)
                        new[j] = max(new[j], c + profile[k])
            profile = new
            
        return max(profile)
            
           
'''
[[&quot;#&quot;,&quot;.&quot;,&quot;#&quot;,&quot;#&quot;,&quot;.&quot;,&quot;#&quot;],[&quot;.&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;#&quot;,&quot;.&quot;],[&quot;#&quot;,&quot;.&quot;,&quot;#&quot;,&quot;#&quot;,&quot;.&quot;,&quot;#&quot;]]
4

[[&quot;.&quot;,&quot;#&quot;],[&quot;#&quot;,&quot;#&quot;],[&quot;#&quot;,&quot;.&quot;],[&quot;#&quot;,&quot;#&quot;],[&quot;.&quot;,&quot;#&quot;]]
3

[[&quot;#&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;#&quot;],[&quot;.&quot;,&quot;#&quot;,&quot;.&quot;,&quot;#&quot;,&quot;.&quot;],[&quot;.&quot;,&quot;.&quot;,&quot;#&quot;,&quot;.&quot;,&quot;.&quot;],[&quot;.&quot;,&quot;#&quot;,&quot;.&quot;,&quot;#&quot;,&quot;.&quot;],[&quot;#&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;#&quot;]]
10

'''
        
        
</PRE>

</BODY>
</HTML>

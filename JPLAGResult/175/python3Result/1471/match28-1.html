<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>119_Harkness.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>119_Harkness.py</CENTER></H3><HR>
<PRE>
import copy

class Solution:
    def maxStudents(self, seats: List[List[str]]) -&gt; int:
<A NAME="0"></A>        self.mem = dict()
        max_cnt = 0
        
        m <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match28-0.html#0',2,'match28-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>= len(seats)
        n = len(seats[0])
        mask = 0
        for i in range(m):
            for j in range(n):
                if seats[</B></FONT>i][j] == '#':
                    mask, _ = self.take_seat(seats, mask, i, j)
        return self.compute(mask, seats, 0, 0)
    
    def compute(self, mask, seats, i, j):
        # print(i, j, mask, seats)
        if mask in self.mem:
            return self.mem[mask]

        m = len(seats)
        n = len(seats[0])
        if mask == pow(2, m*n) - 1:
            return 0
        
        ni, nj = i + (j+1) // n, (j+1) % n
        
        if seats[i][j] == '#':
            self.mem[mask] = self.compute(mask, seats, ni, nj)
        else:
            mask, _ = self.take_seat(seats, mask, i, j)
            # leave empty
            cnt1 = self.compute(mask, seats, ni, nj)
            
            # take seat
            cnt2 = 0
            
            mask, t1 = self.take_seat(seats, mask, i, j+1)
            mask, t2 = self.take_seat(seats, mask, i+1, j-1)
            mask, t3 = self.take_seat(seats, mask, i+1, j+1)
            
            cnt2 = 1 + self.compute(mask, seats, ni, nj)
            
            if t1:
                mask = self.untake_seat(seats, mask, i, j+1)
            if t2:
                mask = self.untake_seat(seats, mask, i+1, j-1)
            if t3:
                mask = self.untake_seat(seats, mask, i+1, j+1)
            
            mask = self.untake_seat(seats, mask, i, j)
            
            self.mem[mask] = max(cnt1, cnt2)
        return self.mem[mask]
    
    def take_seat(self, seats, mask, i, j):
        m = len(seats)
        n = len(seats[0])
        if i &gt;= 0 and i &lt; m and j &gt;= 0 and j &lt; n:
            pos = i * n + j
            mask = mask | (1 &lt;&lt; pos)
            if seats[i][j] == '.':
                seats[i][j] = '#'
                return mask, True
            return mask, False
        return mask, False
    
    def untake_seat(self, seats, mask, i, j):
        m = len(seats)
        n = len(seats[0])
        if i &gt;= 0 and i &lt; m and j &gt;= 0 and j &lt; n:
            seats[i][j] = '.'
            pos = i * n + j
            mask = mask &amp; (~(1 &lt;&lt; pos))
        return mask
        

    
</PRE>

</BODY>
</HTML>

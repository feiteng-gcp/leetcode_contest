<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>454_yaoct.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>454_yaoct.java</CENTER></H3><HR>
<PRE>
<A NAME="0"></A><FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match33-1.html#0',3,'match33-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>class TweetCounts {
    HashMap&lt;String,Node&gt; map;
    public TweetCounts() {
        map=new HashMap&lt;&gt;();
    }
    
    public void recordTweet(String tweetName, int time) {
<A NAME="1"></A>        if(map.get(tweetName)==null){
            map.put(tweetName,new Node());
        }</B></FONT>
        Node root=<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match33-1.html#1',3,'match33-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>map.get(tweetName);
        // System.out.println(123);
        // System.out.println(123+&quot; &quot;+root.sum);
        insert(root,0,1000000001,time);
        // System.out.println(1234+&quot; &quot;+root.sum);
    }
    
<A NAME="2"></A>    public List&lt;Integer&gt; getTweetCountsPerFrequency(String freq, String tweetName, int startTime, int endTime) {
        int d=0;</B></FONT>
        Node root=map.get(tweetName);
        <FONT color="#77bfc7"><A HREF="javascript:ZweiFrames('match33-1.html#2',3,'match33-top.html#2',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>if(freq.equals(&quot;minute&quot;)){
            d=60;
        }else if(freq.equals(&quot;hour&quot;)){
            d=3600;
        }else{
            d=24*3600;
        }
        List&lt;Integer&gt; ret=new ArrayList&lt;&gt;();</B></FONT>
        // System.out.println(&quot;d=&quot;+d);
        for(int i=startTime;i&lt;=endTime;i+=d){
            ret.add(query(root,0,1000000001,i,Math.min(i+d-1,endTime)));
        }
        return ret;
    }
    
    class Node{
		Node lnode,rnode;
		int sum;
	}
    
	private int query(Node node, int l, int r, int s, int e) {
		if(s&lt;=l&amp;&amp;r&lt;=e) {
			return node.sum;
		}
		int m=l+(r-l)/2;
		int ret=0;
		if(m&gt;=s) {
			ret+=query(getLnode(node),l,m,s,e);
		}
		if(m+1&lt;=e) {
			ret+=query(getRnode(node),m+1,r,s,e);
		}
		return ret;
	}
	private void insert(Node node,int l,int r,int idx) {
		if(l==r) {
			node.sum++;
			return;
		}
		Node lnode=getLnode(node);
		Node rnode=getRnode(node);
		int m=l+(r-l)/2;
		if(idx&lt;=m) {
			insert(lnode,l,m,idx);
		}else {
			insert(rnode,m+1,r,idx);
		}
		node.sum=lnode.sum+rnode.sum;
    }
    private Node getLnode(Node node) {
		if(node.lnode==null)node.lnode=new Node();
		return node.lnode;
	}
	private Node getRnode(Node node) {
		if(node.rnode==null)node.rnode=new Node();
		return node.rnode;
    }

}

/**
 * Your TweetCounts object will be instantiated and called as such:
 * TweetCounts obj = new TweetCounts();
 * obj.recordTweet(tweetName,time);
 * List&lt;Integer&gt; param_2 = obj.getTweetCountsPerFrequency(freq,tweetName,startTime,endTime);
 */
</PRE>

</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>44_y119777.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>44_y119777.cpp</CENTER></H3><HR>
<PRE>
const int maxn = 50005, N = 305;
int sum[N][maxn], a[maxn], mul[N][N], cc[N][N];
int tmp[maxn];
int n;
class MajorityChecker {
public:
    int blo;
    int cnt;
    MajorityChecker(vector&lt;int&gt;&amp; arr) {
    n = arr.size();
    for (int i = 0; i &lt; n; i++)
    	a[i] = arr[i];
    blo = ( int )sqrt ( n )+1;
    cnt = ( n+blo-1 )/blo;
    for ( int i = 1; i &lt;= blo; i ++ )
<A NAME="0"></A>    {
        for ( int j = 0; j &lt; n; j ++ )
            sum[i][j] = sum[i-1][j];
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7-0.html#0',2,'match7-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>        for ( int j = ( i-1 )*cnt; j &lt; n &amp;&amp; j &lt; i*cnt; j ++ )
            sum[i][ a[j] ] ++;
    }
    for ( int i = 1; i &lt;= blo; i ++ )
    {
        for ( int j = i; j &lt;= blo; j ++ )
        {
            cc[i][j] = cc[i][j-1];	//注意初始化
            mul[i][j] = mul[i][j-1];
            for ( int k = ( j-1 )*cnt; k &lt; n &amp;&amp; k &lt; j*cnt; k ++ )
            {
                int x = sum[j][ a[k] ]-sum[i-1][ a[k] ];
                if ( x &gt; cc[i][j] || x == cc[i][j] &amp;&amp; mul[i][j] &gt; a[k] )
                {
                    cc[i][j] = x;
                    mul[i][j] = a[k];
                }
            }
        }
    }
}

int query(int left, int right, int threshold) {</B></FONT>
    int L, R, ans, anspos;
    //ans次数最多，anspos次数最多且数字最小
    
<A NAME="1"></A>    {
        L = left; R = right;
        //scanf ( &quot;%d%d&quot;, &amp;L, &amp;R );
<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match7-0.html#1',2,'match7-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>        int x = L/cnt+1, y = R/cnt+1;
        ans = cc[x+1][y-1], anspos = mul[x+1][y-1];
        for ( int i = L; i &lt;= R &amp;&amp; i &lt; x*cnt; i ++ )
            tmp[ a[i] ] = max ( 0, sum[y-1][ a[i] ]-sum[x][ a[i] ] );
        for ( int i = max ( L, ( y-1 )*cnt ); i &lt;= R; i ++ )
            tmp[ a[i] ] = max ( 0, sum[y-1][ a[i] ]-sum[x][ a[i] ] );
        for ( int i = L; i &lt; x*cnt &amp;&amp; i &lt;= R; i ++ )
        {
            tmp[ a[i] ] ++;
            if ( tmp[ a[i] ] &gt; ans || tmp[ a[i] ] == ans &amp;&amp; a[i] &lt; anspos )
            {
                ans = tmp[ a[i] ];
                anspos = a[i];
            }
        }
        if ( x != y )	//同块处理
        {
            for ( int i = ( y-1 )*cnt; i &lt;= R; i ++ )
            {
                tmp[ a[i] ] ++;
                if ( tmp[ a[i] ] &gt; ans || tmp[ a[i] ] == ans &amp;&amp; a[i] &lt; anspos )
                {
                    ans = tmp[ a[i] ];
                    anspos = a[i];
                }
            }
        }
        if (ans &gt;= threshold) return anspos;</B></FONT>
        return -1;
        //printf ( &quot;%d %d\n&quot;, anspos, ans );
    }
}
};

/**
 * Your MajorityChecker object will be instantiated and called as such:
 * MajorityChecker* obj = new MajorityChecker(arr);
 * int param_1 = obj-&gt;query(left,right,threshold);
 */
</PRE>
</BODY>
</HTML>

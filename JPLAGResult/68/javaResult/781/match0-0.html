<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>4_nevergiveup.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>4_nevergiveup.java</CENTER></H3><HR>
<PRE>
class Solution {
	private void action() {
		
		char ch = chStack.pop();
		Map&lt;String , Integer&gt; map2 = stack.pop();
		Map&lt;String , Integer&gt; map1 = stack.pop();
		
		if (ch == '+') {
			Map&lt;String , Integer&gt; map = new HashMap&lt;&gt;();
			for (Map.Entry&lt;String , Integer&gt; entry : map1.entrySet()) {
				if (!map.containsKey(entry.getKey())) {
					map.put(entry.getKey() , entry.getValue());
				} else {
					map.put(entry.getKey() , map.get(entry.getKey()) + entry.getValue());
				}
			}
			for (Map.Entry&lt;String , Integer&gt; entry : map2.entrySet()) {
				if (!map.containsKey(entry.getKey())) {
					map.put(entry.getKey() , entry.getValue());
				} else {
					map.put(entry.getKey() , map.get(entry.getKey()) + entry.getValue());
				}
			}
			stack.push(map);
		} else if (ch == '-') {
			Map&lt;String , Integer&gt; map = new HashMap&lt;&gt;();
			for (Map.Entry&lt;String , Integer&gt; entry : map1.entrySet()) {
				if (!map.containsKey(entry.getKey())) {
					map.put(entry.getKey() , entry.getValue());
				} else {
					map.put(entry.getKey() , map.get(entry.getKey()) + entry.getValue());
				}
			}
			for (Map.Entry&lt;String , Integer&gt; entry : map2.entrySet()) {
				if (!map.containsKey(entry.getKey())) {
					map.put(entry.getKey() , - entry.getValue());
				} else {
					map.put(entry.getKey() , map.get(entry.getKey()) - entry.getValue());
				}
			}
			stack.push(map);
		} else if (ch == '*') {
			Map&lt;String , Integer&gt; map = new HashMap&lt;&gt;();
			for (Map.Entry&lt;String , Integer&gt; entry1 : map1.entrySet()) {
				for (Map.Entry&lt;String , Integer&gt; entry2 : map2.entrySet()) {
					String string = combine(entry1.getKey() , entry2.getKey());
					int value = entry1.getValue() * entry2.getValue();
					if (!map.containsKey(string)) {
						map.put(string , value);
					} else {
						map.put(string , map.get(string) + value);
					}
				}
			}
			stack.push(map);
		}
		
	}
	
	private String combine(String string1 , String string2) {
		
		List&lt;String&gt; list = new ArrayList&lt;&gt;();
		for (String string : string1.split(&quot;[*]&quot;)) {
			if (!string.isEmpty()) {
				list.add(string);
			}
		}
		for (String string : string2.split(&quot;[*]&quot;)) {
			if (!string.isEmpty()) {
				list.add(string);
			}
		}
		Collections.sort(list);
		StringBuilder builder = new StringBuilder();
		boolean first = true;
		for (String string : list) {
			if (first) {
				first = false;
			} else {
				builder.append(&quot;*&quot;);
			}
			builder.append(string);
		}
		return builder.toString();
		
<A NAME="0"></A>	}
	
	private static class Element implements Comparable&lt;Element&gt;{
		public String <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match0-1.html#0',3,'match0-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>string;
		public int cnt;
		public int value;
		public Element(String string , int cnt , int value) {
			this.string = string;</B></FONT>
			this.cnt = cnt;
			this.value = value;
		}
		public int compareTo(Element e) {
			if (this.cnt &gt; e.cnt) {
				return - 1;
			} else if (this.cnt &lt; e.cnt) {
				return 1;
			} else {
				return this.string.compareTo(e.string);
			}
		}
		@Override
		public String toString() {		
			if (this.cnt == 0) {
				return Integer.toString(this.value);
			} else {
				return String.format(&quot;%d*%s&quot; , this.value , this.string);
			}
		}	
	}
	
	private int getCnt(String string) {
		
		if (string.isEmpty()) {
			return 0;
		}
		int ans = 1;
		for (char ch : string.toCharArray()) {
			if (ch == '*') {
				ans ++;
			}
		}
		return ans;
		
	}
	
	private List&lt;String&gt; getResult(Map&lt;String , Integer&gt; map) {
		
		List&lt;String&gt; ans = new ArrayList&lt;&gt;();
		List&lt;Element&gt; list = new ArrayList&lt;&gt;();
		for (Map.Entry&lt;String , Integer&gt; entry : map.entrySet()) {
			if (entry.getValue() != 0) {
				int cnt = getCnt(entry.getKey());
				list.add(new Element(entry.getKey() , cnt , entry.getValue()));
			}
		}
		Collections.sort(list);
		for (Element e : list) {
			ans.add(e.toString());
		}
		return ans;
		
	}
	
	private LinkedList&lt;Character&gt; chStack = new LinkedList&lt;&gt;();
	private LinkedList&lt;Map&lt;String , Integer&gt;&gt; stack = new LinkedList&lt;&gt;();	
	
    public List&lt;String&gt; basicCalculatorIV(String expression, String[] evalvars, int[] evalints) {
     
    	Map&lt;String , Integer&gt; eMap = new HashMap&lt;&gt;();
    	expression = expression.replaceAll(&quot;[ ]+&quot; , &quot;&quot;);
    	int i , length = expression.length();
    	for (i = 0;i &lt; evalints.length;i ++) {
    		eMap.put(evalvars[i] , evalints[i]);
    	}
    	for (i = 0;i &lt; length;i ++) {
    		if (expression.charAt(i) == '(') {
    			chStack.push('(');
    		} else if (expression.charAt(i) == ')') {
    			while (!chStack.peek().equals('(')) {
    				action();
    			}
    			chStack.pop();
    		} else if (expression.charAt(i) &gt;= '0' &amp;&amp; expression.charAt(i) &lt;= '9') {
    			int value = 0;
    			while (i &lt; length &amp;&amp; (expression.charAt(i) &gt;= '0' &amp;&amp; expression.charAt(i) &lt;= '9')) {
    				value = value * 10 + (expression.charAt(i) - '0');
    				i ++;
    			}
    			i --;
    			Map&lt;String , Integer&gt; map = new HashMap&lt;&gt;();
    			map.put(&quot;&quot; , value);
    			stack.push(map);
    		} else if (expression.charAt(i) &gt;= 'a' &amp;&amp; expression.charAt(i) &lt;= 'z') {
    			StringBuilder builder = new StringBuilder();
    			while (i &lt; length &amp;&amp; (expression.charAt(i) &gt;= 'a' &amp;&amp; expression.charAt(i) &lt;= 'z')) {
    				builder.append(expression.charAt(i));
    				i ++;
    			}
    			i --;
    			Map&lt;String , Integer&gt; map = new HashMap&lt;&gt;();
    			if (eMap.containsKey(builder.toString())) {
    				map.put(&quot;&quot; , eMap.get(builder.toString()));
    			} else {
    				map.put(builder.toString() , 1);
    			}
    			stack.push(map);
    		} else if (expression.charAt(i) == '+') {
    			while (!chStack.isEmpty() &amp;&amp; (chStack.peek() == '-' || chStack.peek() == '*')) {    				
    				action();
    			}
    			chStack.push('+');
    		} else if (expression.charAt(i) == '-') {
    			while (!chStack.isEmpty() &amp;&amp; (chStack.peek() == '-' || chStack.peek() == '*')) {    				
    				action();
    			}
    			chStack.push('-');
    		} else if (expression.charAt(i) == '*') {
    			chStack.push('*');
    		}
    	}
    	while (!chStack.isEmpty()) {
    		action();
    	}
    	return getResult(stack.pop());
    	
    }
}
</PRE>

</BODY>
</HTML>

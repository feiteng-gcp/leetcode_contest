<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>380_megaspazz.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>380_megaspazz.java</CENTER></H3><HR>
<PRE>
class Solution {
    public int uniquePathsIII(int[][] grid) {
<A NAME="0"></A>        int N = grid.length;
        int M = grid[0].length;
        StepTrack st = new StepTrack(N, M);
        <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match20-1.html#0',3,'match20-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>int r0 = -1, c0 = -1, rf = -1, cf = -1;
        int want = 1;
        for (int i = 0; i &lt; N; ++i) {
            for (int j = 0; j &lt; M; ++j) {
                if (grid[i][j] == 1) {
                    r0 = i;
                    c0 = j;
                } else if (grid[i][j] == 2) {</B></FONT>
                    rf = i;
                    cf = j;
                } else if (grid[i][j] == 0) {
                    ++want;
                }
<A NAME="1"></A>            }
        }
        ArrayList&lt;Integer&gt; path = new ArrayList&lt;&gt;();
        <FONT color="#f63526"><A HREF="javascript:ZweiFrames('match20-1.html#1',3,'match20-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>dfs(grid, r0, c0, rf, cf, want, st, path);
        // System.out.format(&quot;%d, %d -&gt; %d, %d | %d\n&quot;, r0, c0, rf, cf, want);
        return st.total;
    }
    
    private static final int[] DR = { -1, 0, 1, 0 };
    private static final int[] DC = { 0, 1, 0, -1 };
    
    public static void dfs(int[][] grid, int r, int c, int rf, int cf</B></FONT>, int want, StepTrack st, ArrayList&lt;Integer&gt; path) {
        if (r == rf &amp;&amp; c == cf) {
            // System.out.format(&quot;%d ?= %d\n&quot;, st.size, want);
            // System.out.println(path);
            if (st.size == want) {
                ++st.total;
            }
            return;
        }
        
        // if (grid[r][c] == -1) {
        //     return;
        // }
        
        // if (st.has(r, c)) {
        //     return;
        // }
        
        // path.add(r);
        // path.add(c);
        st.add(r, c);
        
        for (int d = 0; d &lt; DR.length; ++d) {
            int nr = r + DR[d];
            int nc = c + DC[d];
            if (st.valid(nr, nc) &amp;&amp; !st.has(nr, nc) &amp;&amp; grid[r][c] != -1) {
                dfs(grid, nr, nc, rf, cf, want, st, path);
            }
        }
        
        // path.remove(path.size() - 1);
        // path.remove(path.size() - 1);
        st.remove(r, c);
    }
    
    public static class StepTrack {
        public int total;
        
        public boolean[][] on;
        public int size;
        
        public StepTrack(int n, int m) {
            on = new boolean[n][m];
        }
        
        public boolean has(int r, int c) {
            return on[r][c];
        }
        
        public void add(int r, int c) {
            if (!on[r][c]) {
                ++size;
                on[r][c] = true;
            }
        }
        
        public void remove(int r, int c) {
            if (on[r][c]) {
                on[r][c] = false;
                --size;
            }
        }
        
        public boolean valid(int r, int c) {
            return r &gt;= 0 &amp;&amp; r &lt; on.length &amp;&amp; c &gt;= 0 &amp;&amp; c &lt; on[r].length;
        }
    }
}
</PRE>

</BODY>
</HTML>

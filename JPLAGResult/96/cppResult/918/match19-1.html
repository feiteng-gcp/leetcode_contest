<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>1_yubowenok.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>1_yubowenok.cpp</CENTER></H3><HR>
<PRE>
typedef long long ll;
typedef vector&lt;int&gt; VI;
typedef pair&lt;int,int&gt; PII;

#define REP(i,s,t) for(int i=(s);i&lt;(t);i++)
#define FILL(x,v) memset(x,v,sizeof(x))

const int INF = (int)1E9 + (int)1E6;
#define MAXN 3005

bool v[MAXN];
int dst[MAXN];
vector&lt;PII&gt; adj[MAXN];
<A NAME="0"></A>map&lt;PII, int&gt; lowc, highc, cnt;
struct dij {
  int x, d;
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match19-0.html#0',2,'match19-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>  dij(int _x, int _d): x(_x), d(_d) {}
  bool operator &lt; (const dij &amp;ano) const {
    return d &gt; ano.d;
  }
};
class Solution {</B></FONT>
public:
  int reachableNodes(vector&lt;vector&lt;int&gt;&gt;&amp; edges, int M, int N) {
    FILL(v, 0);
    REP(i,0,N) adj[i].clear();
    lowc.clear(); highc.clear(); cnt.clear();
    REP(i,0,edges.size()) {
      int x = edges[i][0], y = edges[i][1], c = edges[i][2];
      adj[x].push_back(PII(y, c));
      adj[y].push_back(PII(x, c));
      PII e = PII(x, y);
      lowc[e] = highc[e] = 0;
      cnt[e] = c;
    }
    priority_queue&lt;dij&gt; pq;
    REP(i,0,N) dst[i] = INF;
    dst[0] = 0;
    pq.push(dij(0, 0));
    while (pq.size()) {
      dij now = pq.top(); pq.pop();
      if (now.d &gt; dst[now.x]) continue;
      if (now.d &gt; M) continue;
      int x = now.x;
      int sz = adj[x].size();
      REP(i,0,sz) {
        int y = adj[x][i].first, c = adj[x][i].second;
        int nd = now.d + c + 1;
        PII e = x &lt; y ? PII(x, y) : PII(y, x);
        if (nd &lt;= M) {
          lowc[e] = highc[e] = c;
          if (nd &lt; dst[y]) {
            dst[y] = nd;
            pq.push(dij(y, nd));
          }
        } else {
          int s = M - now.d;
          if (x &lt; y) lowc[e] = max(lowc[e], s);
          else highc[e] = max(highc[e], s);
        }
      }
    }
    int ans = 0;
    REP(i,0,N) if (dst[i] &lt; INF) ans++;
    for (auto it = lowc.begin(); it != lowc.end(); it++) {
      int l = it-&gt;second, h = highc[it-&gt;first];
      ans += min(l + h, cnt[it-&gt;first]);
    }
    return ans;
  }
};
</PRE>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>314_foxspy.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>314_foxspy.cpp</CENTER></H3><HR>
<PRE>
class Solution {
public:
    string decodeAtIndex(string S, int K) {
       long long int unit = 0;
       vector&lt;pair&lt;int,int&gt;&gt; log;
       for(int i = 0; i &lt; S.size(); i++){
           if(S[i] &gt;= '0' &amp;&amp; S[i] &lt;= '9'){
              log.push_back(make_pair(unit,S[i]-'0'));
              unit = unit * (S[i] - '0');
           }
           else{
              unit = unit + 1;
              if(unit == K){
                 return S.substr(i,1);
              }
           }
           if(unit &lt; K){
              continue;
           }
           else{
              int modk = K;
<A NAME="0"></A>              for(int index = log.size()-1; index &gt; 0; index--){
                  modk = modk % log[index].first;
                  if(modk &gt; log[index-1].first*log[index-1].second){
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match32-1.html#0',3,'match32-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>                     int offset = modk - log[index-1].first*log[index-1].second;
                     for(int jndex = 0; jndex &lt; index; jndex++){
                         if(jndex == 0){
                            offset += log[jndex].first + 1;
                         }
                         else{
                            offset += log[jndex].first - (log[jndex-1].first*log[jndex-1].second) + 1;
                         }</B></FONT>
                     }
                     return S.substr(offset-1,1);
                  }
                  else if(modk == 0){
                     int last = log[0].first - 1;
                     int offset = 0;
                     for(int jndex = 0; jndex &lt;= index; jndex++){
                         if(jndex == 0){
                            offset += log[jndex].first + 1;
                         }
                         else{
                            offset += log[jndex].first - (log[jndex-1].first*log[jndex-1].second) + 1;
                            if(log[jndex].first - (log[jndex-1].first*log[jndex-1].second) &gt; 0){
                               last = offset - 2;
                            }
                         }
                     }
                     return S.substr(last,1);
                  }
              }
              return S.substr((modk + log[0].first - 1)%log[0].first,1);
           }
       }
    }
};
</PRE>
</BODY>
</HTML>

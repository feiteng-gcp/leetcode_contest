<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>1_x____x.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>1_x____x.cpp</CENTER></H3><HR>
<PRE>
int t[32][32][1 &lt;&lt; 6];
int dr[] = {-1, 0, 1, 0}, dc[] = {0, 1, 0, -1};

class Solution {
    int n, m;
<A NAME="0"></A>    vector&lt;string&gt; g;
    
    int go(int r, int c) {
<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match10-0.html#0',2,'match10-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>        int all = 0;
        for (int i = 0; i &lt; n; ++i) for (int j = 0; j &lt; m; ++j) {
            if ('a' &lt;= g[i][j] &amp;&amp; g[i][j] &lt;= 'z') {
                all |= 1 &lt;&lt; (g[i][j] - 'a');
            }</B></FONT>
        }
        memset(t, 0xff, sizeof(t));
        t[r][c][0] = 0;
        deque&lt;int&gt; que;
        que.push_back((r &lt;&lt; 12) + (c &lt;&lt; 6) + 0);
        while (!que.empty()) {
            int key = que.front();
            que.pop_front();
            r = key &gt;&gt; 12;
            c = (key &gt;&gt; 6) &amp; 0x3f;
            int k = key &amp; 0x3f;
            // cout &lt;&lt; r &lt;&lt; &quot; &quot; &lt;&lt; c &lt;&lt; &quot; &quot; &lt;&lt; k &lt;&lt; endl;
            for (int d = 0; d &lt; 4; ++d) {
                int r1 = r + dr[d], c1 = c + dc[d];
                if (r1 &lt; 0 || r1 &gt;= n || c1 &lt; 0 || c1 &gt;= m) continue;
                char ch = g[r1][c1];
                if ('#' == ch) continue;
                if ('A' &lt;= ch &amp;&amp; ch &lt;= 'Z') {
                    int x = 1 &lt;&lt; (ch - 'A');
                    if (!(k &amp; x)) continue;
                }
                int k1 = k;
                if ('a' &lt;= ch &amp;&amp; ch &lt;= 'z') {
                    k1 |= (1 &lt;&lt; (ch - 'a'));
                }
                if (t[r1][c1][k1] &lt; 0) {
                    t[r1][c1][k1] = t[r][c][k] + 1;
                    if (k1 == all) {
                        return t[r1][c1][k1];
                    }
                    que.push_back((r1 &lt;&lt; 12) + (c1 &lt;&lt; 6) + k1);
                }
            }
        }
        return -1;
    }
public:
    int shortestPathAllKeys(vector&lt;string&gt;&amp; grid) {
        g = grid;
        n = g.size();
        if (n &lt; 1) return -1;
        m = g[0].size();
        if (m &lt; 1) return -1;
        for (int i = 0; i &lt; n; ++i) for (int j = 0; j &lt; m; ++j) {
            if ('@' == g[i][j]) return go(i, j);
        }
        return -1;
    }
};
</PRE>
</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>17_seraph1212.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>17_seraph1212.java</CENTER></H3><HR>
<PRE>
class Solution {
    int n, m;
    int[][] d = new int[][] {{0, 1}, {0, -1}, {1, 0}, {-1, 0}};
    public int shortestPathAllKeys(String[] grid) {
        n = grid.length;
        m = grid[0].length();
        char[][] g = new char[n][m];
        int sx = -1, sy = -1;
        int kn = 0;
        for (int i = 0; i &lt; n; i++) {
            for (int j = 0; j &lt; m; j++) {
                g[i][j] = grid[i].charAt(j);
                if (g[i][j] == '@') {
                    sx = i;
                    sy = j;
                    g[i][j] = '.';
                }
                if (g[i][j] &gt;= 'a' &amp;&amp; g[i][j] &lt;= 'f') {
                    kn++;
                }
            }
        }
        return bfs(sx, sy, g, kn);
    }

    int bfs(int sx, int sy, char[][] g, int kn) {
        int[] start = new int[] {sx, sy, 0};
        boolean[][][] vis = new boolean[g.length][g[0].length][(1 &lt;&lt; kn)];
        Deque&lt;int[]&gt; q = new ArrayDeque&lt;&gt;();
<A NAME="1"></A>        vis[sx][sy][0] = true;
        q.offer(start);
        int step = 0;
        <FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match0-0.html#1',2,'match0-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>while (!q.isEmpty()) {
<A NAME="0"></A>            int sz = q.size();
            for (int ccc = 0; ccc &lt; sz; ccc++) {
                int[] u = q.poll()</B></FONT>;
                <FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match0-0.html#0',2,'match0-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>int x = u[0], y = u[1], s = u[2];
                if (s + 1 == (1 &lt;&lt; kn)) {
                    return step;
                }
                for (int dir = 0; dir &lt; 4; dir++) {</B></FONT>
                    int xx = x + d[dir][0];
                    int yy = y + d[dir][1];
                    if (xx &lt; 0 || xx &gt;= n || yy &lt; 0 || yy &gt;= m || g[xx][yy] == '#')
                        continue;
                    if (lock(s, g[xx][yy])) continue;
                    int ss = getKeyStatus(s, g[xx][yy]);
                    if (vis[xx][yy][ss]) continue;
<A NAME="2"></A>                    vis[xx][yy][ss] = true;
                    q.offer(new int[] {xx, yy, ss});
                }
            <FONT color="#77bfc7"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match0-0.html#2',2,'match0-top.html#2',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>}
            step++;
        }
        return -1;
    }
    boolean lock(int s</B></FONT>, char ch) {
        if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'F') {
            return (s &amp; (1 &lt;&lt; (ch - 'A'))) == 0;
        }
        return false;
    }
    int getKeyStatus(int s, char ch) {
        if (ch &gt;= 'a' &amp;&amp; ch &lt;= 'f') {
            return (1 &lt;&lt; (ch - 'a')) | s;
        }
        return s;
    }
}
</PRE>

</BODY>
</HTML>

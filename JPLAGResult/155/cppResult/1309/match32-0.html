<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>54_balakrishnan_v.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>54_balakrishnan_v.cpp</CENTER></H3><HR>
<PRE>
<A NAME="0"></A>class Solution {
public:
    
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match32-1.html#0',3,'match32-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>    vector&lt;int&gt; GetTopSort(const vector&lt;vector&lt;int&gt;&gt;&amp; edges) {
        int n = edges.size();
        vector&lt;int&gt; indegrees(n,0);
        for(int i=0;i&lt;n;i++)
            for(int j : edges[i])
                indegrees[j]++;
        
        set&lt;pair&lt;int,int&gt;&gt; deg_gid_q;</B></FONT>
        for(int i=0;i&lt;n;i++) {
            deg_gid_q.insert({indegrees[i],i});
        }
        vector&lt;int&gt; sorted_elems;
        while(!deg_gid_q.empty()) {
            pair&lt;int,int&gt; deg_gid = *deg_gid_q.begin();
            deg_gid_q.erase(deg_gid_q.begin());
            int g = deg_gid.second;
            int deg = deg_gid.first;
            if (deg != 0) {
                return vector&lt;int&gt;();
            }
            sorted_elems.push_back(g);
            
            for(int gg : edges[g]) {
                deg_gid_q.erase({indegrees[gg],gg});
                indegrees[gg]--;
                deg_gid_q.insert({indegrees[gg],gg});                
            }
        }
        return sorted_elems;
    }
    
    
    vector&lt;int&gt; sortItems(int n, int m, vector&lt;int&gt;&amp; group, vector&lt;vector&lt;int&gt;&gt;&amp; beforeItems) {
        for(int i=0;i&lt;n;i++) {
            if (group[i]==-1) {
                group[i]=m;
                m++;
            }
<A NAME="1"></A>        }
        
        vector&lt;set&lt;int&gt;&gt; afterGroups(m, set&lt;int&gt;());
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match32-1.html#1',3,'match32-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        vector&lt;vector&lt;int&gt;&gt; afterItems(n, vector&lt;int&gt;());
        
        for(int i=0;i&lt;n;i++) {
            int g = group[i];
            for(int j : beforeItems[i]) {
                afterItems[j].push_back(i);
                int gb = group[j];
                    if (gb == g)</B></FONT>
                        continue;
                afterGroups[gb].insert(g);
            }
        }
        
        vector&lt;vector&lt;int&gt;&gt; afterGroupsVec(m, vector&lt;int&gt;());
        for(int i=0;i&lt;afterGroups.size();++i) {
            afterGroupsVec[i]=vector&lt;int&gt;(afterGroups[i].begin(),afterGroups[i].end());
        }
        
        vector&lt;int&gt; group_sorted = GetTopSort(afterGroupsVec);
        
        vector&lt;int&gt; vert_sorted = GetTopSort(afterItems);
        
        if (group_sorted.empty() || vert_sorted.empty())
            return vector&lt;int&gt;();
        
        vector&lt;int&gt; group_rank(m, -1);
        for(int i=0;i&lt;m;i++) {
            group_rank[group_sorted[i]]=i;
        }
        
        vector&lt;int&gt; vert_rank(n, -1);
        for(int i=0;i&lt;n;i++) {
            vert_rank[vert_sorted[i]]=i;
        }
        
        vector&lt;pair&lt;int,pair&lt;int,int&gt;&gt;&gt; tmp;
        for(int i=0;i&lt;n;i++) {
            int g = group[i];
            tmp.push_back({group_rank[g], {vert_rank[i],i}});
        }
        
        sort(tmp.begin(),tmp.end());
        vector&lt;int&gt; ranks(n, -1);
        vector&lt;int&gt; ans;
        for(int i=0;i&lt;n;i++) {
            ans.push_back(tmp[i].second.second);
            ranks[tmp[i].second.second]=i;
        }
        
        for(int i=0;i&lt;n;i++) {
            for(int j : beforeItems[i]) {
                if (ranks[j]&gt;ranks[i])
                    return vector&lt;int&gt;();
            }
        }
        
        return ans;
        
        
    }
};
</PRE>
</BODY>
</HTML>

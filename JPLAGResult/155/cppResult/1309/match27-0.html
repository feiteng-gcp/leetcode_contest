<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>53_kangbb.cpp</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>53_kangbb.cpp</CENTER></H3><HR>
<PRE>
class Solution {
public:
    
    vector&lt;int&gt; sortItems(int n, int m, vector&lt;int&gt;&amp; group, vector&lt;vector&lt;int&gt;&gt;&amp; beforeItems) {
        vector&lt;vector&lt;int&gt;&gt; g(m);
        for (int i = 0; i &lt; n; ++i) {
            if (group[i] == -1) {
                group[i] = g.size();
                g.push_back({i});
            } else {
                g[group[i]].push_back(i);
            }
        }
        
        
        // for (int i = 0; i &lt; g.size(); ++i) {
        //     cout &lt;&lt; &quot;g:&quot; &lt;&lt; i &lt;&lt; &quot; &quot;;
        //             for (auto it:g[i] ) {
        //     cout &lt;&lt; it &lt;&lt; &quot; &quot;;
        // }
        //     cout &lt;&lt; endl;
        // }
        // in-degree for each group
        queue&lt;int&gt; q;
        vector&lt;vector&lt;int&gt;&gt; glink(g.size());
        vector&lt;int&gt; gind(g.size(), 0);
        for (int i = 0; i &lt; n; ++i) {
            for (auto it: beforeItems[i]) {
                // ele 1: group 3, before 6
                // ele 6: group 0
                // so glink[0] = {3}
                // so gind[3] = 1;
                if (group[i] != group[it]) {
                    glink[group[it]].push_back(group[i]);
                    gind[group[i]]++;
                }
            }
        }
        
        vector&lt;int&gt; sortg;

        // for each group with in-degree = 0
        for (int i = 0; i &lt; gind.size(); ++i) {
            // cout &lt;&lt; gind[i] &lt;&lt; &quot; =&gt; &quot;;
            // for (auto it:glink[i] ) {
            //     cout &lt;&lt; it &lt;&lt; &quot; &quot;;
            // }
            // cout &lt;&lt; endl;
            
<A NAME="0"></A>            if (gind[i] == 0) {
                q.push(i);
            }
<FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match27-1.html#0',3,'match27-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>        }
         // cout &lt;&lt; endl;
        
        while (!q.empty()) {
            int u = q.front(); q.pop();
            
            // put group u into sorted list
            sortg.push_back(u);
            
            for (int i = 0; i &lt; glink[u].size(); ++i) {
                int next = glink[u][i];
                // decrease the degree to that group
                --gind[next];

                if (gind[next] == 0) {</B></FONT>
                    q.push(next);
                }
            }
        }
        
        if (sortg.size() != g.size()) return {};
        
        // for (auto it:sortg ) {
        //     cout &lt;&lt; it &lt;&lt; &quot; &quot;;
        // }
        
        vector&lt;vector&lt;int&gt;&gt; link(n);
        vector&lt;int&gt; ind(n, 0);
        for (int i = 0; i &lt; g.size(); ++i) {
            // cout &lt;&lt; i &lt;&lt; &quot; group &gt;&gt;&gt;&gt;&quot; &lt;&lt; endl;;
            vector&lt;int&gt; v = g[i];
            vector&lt;int&gt; r;
            
            // for (auto it: v ) {
            //     cout &lt;&lt; it &lt;&lt; &quot; &quot;;
            // }
            // cout &lt;&lt; endl;
            // topo sort to v
            // create link
            for (int j = 0; j &lt; v.size(); ++j) {
                int a = v[j];
                for (int k = 0; k &lt; beforeItems[a].size(); ++k) {
                    // ele a = 1: group 3, before 6 = b
                    // ele b = 6: group 0
                    // so link[6] = {1}
                    // so ind[1] = 1;
                    int b = beforeItems[a][k];
                    if (group[a] != group[b]) continue;
                    link[b].push_back(a);
                    ind[a]++;
                }
            }
            for (int j = 0; j &lt; v.size(); ++j) {
                // cout &lt;&lt; v[j] &lt;&lt; &quot; ind:&quot; &lt;&lt; ind[v[j]] &lt;&lt; endl;;
<A NAME="1"></A>                if (ind[v[j]] == 0) {
                    q.push(v[j]);
                }
<FONT color="#f63526"><A HREF="javascript:ZweiFrames('match27-1.html#1',3,'match27-top.html#1',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>            }
            
            while (!q.empty()) {
                int u = q.front(); q.pop();

                // put item u into sorted list
                r.push_back(u);

                for (int j = 0; j &lt; link[u].size(); ++j) {
                    int next = link[u][j];
                    // decrease the degree to that element
                    --ind[next];

                    if (ind[next] == 0) {</B></FONT>
                        q.push(next);
                    }
                }
            }
            
            if (r.size() != v.size()) return {};
            // for (auto it: r ) {
            //     cout &lt;&lt; it &lt;&lt; &quot; &quot;;
            // }
            // cout &lt;&lt; endl;
            
            g[i] = r;
        }
        
        vector&lt;int&gt; ret;
        for (auto it: sortg) {
            for (auto iit: g[it]) {
                ret.push_back(iit);
            }
        }
        
        // topo sort to each in-group
        // topo sort between each group
        return ret;
    }
};
</PRE>
</BODY>
</HTML>

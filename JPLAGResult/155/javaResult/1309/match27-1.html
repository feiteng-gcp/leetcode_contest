<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>14_uwi.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>14_uwi.java</CENTER></H3><HR>
<PRE>
	class Solution {
	    public int[] sortItems(int n, int m, int[] group, List&lt;List&lt;Integer&gt;&gt; beforeItems) {
	        for(int i = 0;i &lt; n;i++){
	        	if(group[i] == -1){
	        		group[i] = m++;
	        	}
	        }
	        int u = 0;
	        for(List&lt;Integer&gt; row : beforeItems)u += row.size();
	        int[] from = new int[u];
	        int[] to = new int[u];
	        int p = 0;
	        for(int i = 0;i &lt; beforeItems.size();i++){
	        	for(int x : beforeItems.get(i)){
	        		if(group[x] != group[i]){
		        		from[p] = group[x];
		        		to[p] = group[i];
		        		p++;
	        		}
	        	}
	        }
	        int[][] cg = packD(m, from, to, p);
	        int[] cord = sortTopologically(cg);
	        if(cord == null)return new int[0];
	        
	        int[] from2 = new int[u];
	        int[] to2 = new int[u];
	        p = 0;
	        for(int i = 0;i &lt; beforeItems.size();i++){
	        	for(int x : beforeItems.get(i)){
	        		if(group[x] == group[i]){
		        		from2[p] = x;
		        		to2[p] = i;
		        		p++;
	        		}
	        	}
	        }
	        int[][] g = packD(n, from2, to2, p);
	        int[] ord = sortTopologically(g);
	        if(ord == null)return new int[0];
	        int[] iord = new int[n];
	        for(int i = 0;i &lt; n;i++)iord[ord[i]] = i;
	        final int[] io = iord;
	        
	        List&lt;List&lt;Integer&gt;&gt; all = new ArrayList&lt;&gt;();
	        for(int i = 0;i &lt; m;i++)all.add(new ArrayList&lt;Integer&gt;());
	        for(int i = 0;i &lt; n;i++)all.get(group[i]).add(i);
	        
	        int[] ret = new int[n];
	        p = 0;
	        for(int i = 0;i &lt; m;i++){
	        	Collections.sort(all.get(cord[i]), new Comparator&lt;Integer&gt;() {
					public int compare(Integer a, Integer b) {
						return io[a] - io[b];
					}
				});
	        	for(int t : all.get(cord[i])){
	        		ret[p++] = t;
	        	}
	        }
	        return ret;
	    }
	    
		public int[] sortTopologically(int[][] g)
		{
			int n = g.length;
<A NAME="0"></A>			int[] ec = new int[n];
			for(int i = 0;i &lt; n;i++){
				for(int to : g[i])ec[to]++;
			}<FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match27-0.html#0',2,'match27-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>
			int[] ret = new int[n];
			int q = 0;
			
			// sources
			for(int i = 0;i &lt; n;i++){
				if(ec[i] == 0)ret[q++] = i;</B></FONT>
			}
			
			for(int p = 0;p &lt; q;p++){
				for(int to : g[ret[p]]){
					if(--ec[to] == 0)ret[q++] = to;
				}
<A NAME="1"></A>			}
			// loop
			for(int i = 0;i &lt; n;i++){
				if(ec[i] &gt; 0)return null;<FONT color="#f63526"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match27-0.html#1',2,'match27-top.html#1',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>
			}
			return ret;
		}

	    
		public int[][] packD(int n, int[] from, int[] to){ return packD(n, from</B></FONT>, to, from.length);}
		public int[][] packD(int n, int[] from, int[] to, int sup)
		{
			int[][] g = new int[n][];
			int[] p = new int[n];
			for(int i = 0;i &lt; sup;i++)p[from[i]]++;
			for(int i = 0;i &lt; n;i++)g[i] = new int[p[i]];
			for(int i = 0;i &lt; sup;i++){
				g[from[i]][--p[from[i]]] = to[i];
			}
			return g;
		}

	}	
</PRE>

</BODY>
</HTML>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>87_yu1419.py</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff">
<HR>
<H3><CENTER>87_yu1419.py</CENTER></H3><HR>
<PRE>
class Solution:
    def sortItems(self, n: int, m: int, group: List[int], beforeItems: List[List[int]]) -&gt; List[int]:
        max_g = m + 1
        
        gs = collections.defaultdict(set)
        in_group_sort = collections.defaultdict(list)
        
        refer = {}
        for i in range(len(group)):
            if group[i] == -1:
                gs[max_g].add(i)
                refer[i] = max_g
                max_g += 1
            else:
                gs[group[i]].add(i)
                refer[i] = group[i]
                
        #print(gs)
        seen = set()
        add_list = [] #[a,b] a before b
        for i in range(len(group)):
            for a in beforeItems[i]:
                ga, gb = refer[a], refer[i]
                
                if ga == gb:
                    in_group_sort[ga].append([a, i])
                    
                else:
                    if str([ga, gb]) in seen:
                        continue
                    else:
                        seen.add(str([ga, gb]))
                        add_list.append([ga, gb])
        
        
        
        def topological_sort(values, edges):
            
            before_list = collections.defaultdict(set)
            after_list = collections.defaultdict(set)
            
            for i in values:
                before_list[i]
                after_list[i]
            for a, b in edges:
                before_list[b].add(a)
                after_list[a].add(b)

            q = [i for i in before_list if len(before_list[i]) == 0]
    
            tp_sort = []

<A NAME="0"></A>            while q:
                cur = q.pop(0)
                tp_sort.append(cur)
                <FONT color="#0000ff"><A HREF="javascript:ZweiFrames('match13-1.html#0',3,'match13-top.html#0',1)"><IMG SRC="forward.gif" ALT="other" BORDER="0" ALIGN="right"></A><B>for k in after_list[cur]:
                    before_list[k].remove(cur)
                    if len(before_list[k]) == 0:
                        q.append(k</B></FONT>)
                            #del before_list[k]
            return tp_sort


            
        
        groups = topological_sort(range(max_g), add_list)
        #print(&quot;groups&quot;)
        #print(groups)
        res = []
        for i in groups:
            x = topological_sort(gs[i], in_group_sort[i])
            for k in x:
                res.append(k)
        if len(res) == n:
            return res
        else:
            return []
                    
                    
                    
                    
</PRE>

</BODY>
</HTML>

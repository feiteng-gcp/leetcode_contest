<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
 <TITLE>211_linglingling.java</TITLE>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script type="text/javascript">
  <!--
   function ZweiFrames(URL1,F1,URL2,F2)
   {
    parent.frames[F1].location.href=URL1;
    parent.frames[F2].location.href=URL2;
   }
  //-->
  </script>
</HEAD>
<BODY BGCOLOR="#ffffff" style="margin-left:25">
<HR>
<H3><CENTER>211_linglingling.java</CENTER></H3><HR>
<PRE>
<A NAME="0"></A><FONT color="#0000ff"><div style="position:absolute;left:0"><A HREF="javascript:ZweiFrames('match1-0.html#0',2,'match1-top.html#0',1)"><IMG SRC="back.gif" ALT="other" BORDER="0" ALIGN="left"></A></div><B>class Solution {
    public boolean pyramidTransition(String bottom, List&lt;String&gt; allowed) {
        Map&lt;Character, Map&lt;Character, Set&lt;Character&gt;&gt;&gt; map = new HashMap&lt;&gt;();
        for (String s : allowed) {
            char a = s.charAt</B></FONT>(0), b = s.charAt(1), c = s.charAt(2);
            if (!map.containsKey(a)) map.put(a, new HashMap&lt;&gt;());
            if (!map.get(a).containsKey(b)) map.get(a).put(b, new HashSet&lt;&gt;());
            map.get(a).get(b).add(c);
        }
        List&lt;List&lt;Character&gt;&gt; py = new ArrayList&lt;&gt;();
        List&lt;Character&gt; l0 = new ArrayList&lt;&gt;();
        for (char cr: bottom.toCharArray()) {
            l0.add(cr);
        }
        py.add(l0);
        return backtrack(py, 1, map);
    }
    
    public boolean backtrack(List&lt;List&lt;Character&gt;&gt; py, int level, Map&lt;Character, Map&lt;Character, Set&lt;Character&gt;&gt;&gt; allowed) {
        int botsize = py.get(0).size();
        if (level == botsize) {
            return true;
        } else {
            int pos = 0;
            if (level &gt;= py.size()) {
                py.add(new ArrayList&lt;&gt;());
            } else {
                pos = py.get(level).size();
            }
            char left = py.get(level-1).get(pos), right = py.get(level-1).get(pos+1);
            if (allowed.containsKey(left) &amp;&amp; allowed.get(left).containsKey(right)) {
                for (char c: allowed.get(left).get(right)) {
                    py.get(level).add(c);
                    if (py.get(level).size() == py.get(level-1).size() - 1) {
                        if (backtrack(py, level+1, allowed)) return true;
                    } else {
                        if (backtrack(py, level, allowed)) return true;
                    }
                    py.get(level).remove(py.get(level).size() - 1);
                }
                return false;
            } else {
                return false;
            }
        }
    }
}
</PRE>

</BODY>
</HTML>
